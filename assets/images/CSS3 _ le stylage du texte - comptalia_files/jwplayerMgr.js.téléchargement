document.addEventListener('DOMContentLoaded', function () {
	var players = document.querySelectorAll('div.jwplayer');
	Array.prototype.forEach.call(players, function (player) {
		try {
			var setup = {
				aspectratio: "16:9",
				width: "100%",
				image: scServices.scLoad.resolveDestUri("/skin/img/player/poster.jpg"),
				playbackRateControls: [0.5, 0.75, 1.0, 1.25, 1.5, 2.0],
				localization: {
					"advertising": {
						"admessage": "La publicité prendra fin dans xx",
						"cuetext": "Publicité",
						"displayHeading": "Publicité",
						"loadingAd": "Chargement de la publicité",
						"podmessage": "Publicité __AD_POD_CURRENT__ sur __AD_POD_LENGTH__.",
						"skipmessage": "Sauter la publicité dans xx",
						"skiptext": "Sauter"
					},
					"airplay": "AirPlay",
					"audioTracks": "Pistes Audio",
					"auto": "Automatique",
					"buffer": "Chargement",
					"cast": "Chromecast",
					"cc": "Sous-titres",
					"close": "Fermer",
					"errors": {
						"badConnection": "À la suite d\'un problème de connexion Internet, la vidéo ne peut être lue.",
						"cantLoadPlayer": "Désolé, la vidéo n\'a pas pu se charger.",
						"cantPlayInBrowser": "Ce navigateur n\'est pas pris en charge.",
						"cantPlayVideo": "La vidéo ne peut être lue.",
						"errorCode": "Code d\'erreur",
						"liveStreamDown": "Le streaming en live est en maintenance ou a pris fin.",
						"protectedContent": "Nous n\'avons pas réussi à accéder à ce contenu protégé.",
						"technicalError": "Une erreur technique empêche la lecture de la vidéo."
					},
					"exitFullscreen": "Sortir du Mode Plein Écran",
					"fullscreen": "Plein Écran",
					"hd": "Qualité",
					"liveBroadcast": "Live",
					"logo": "Logo",
					"mute": "Désactiver le Son",
					"next": "Suite",
					"nextUp": "Prochaine Vidéo",
					"notLive": "Hors Live",
					"off": "Désactiver",
					"pause": "Pause",
					"play": "Lecture",
					"playback": "Lecture",
					"playbackRates": "Vitesse de Lecture",
					"player": "Video Player",
					"poweredBy": "Fourni par",
					"prev": "Précédent",
					"related": {
						"autoplaymessage": "Prochaine vidéo dans xx",
						"heading": "Plus de Vidéos"
					},
					"replay": "Replay",
					"rewind": "10 Secondes en Arrière",
					"settings": "Paramètres",
					"sharing": {
						"copied": "Copié",
						"email": "Courriel",
						"embed": "Intégrer",
						"heading": "Partager",
						"link": "Lien"
					},
					"slider": "Barre de Lecture",
					"stop": "Stop",
					"unmute": "Activer le Son",
					"videoInfo": "À Propos de Cette Vidéo",
					"volume": "Volume",
					"volumeSlider": "Barre de Volume",
					"shortcuts": {
						"playPause": "Play/Pause",
						"volumeToggle": "Désactiver le Son/Activer le Son",
						"fullscreenToggle": "Plein Écran/Sortir du Mode Plein Écran",
						"seekPercent": "Avancer %",
						"keyboardShortcuts": "Raccourci Clavier",
						"increaseVolume": "Augmenter le Volume",
						"decreaseVolume": "Diminuer le Volume",
						"seekForward": "Avancer",
						"seekBackward": "Reculer",
						"spacebar": "Espace",
						"captionsToggle": "Sous-titres Activés/Désactivés"
					}
				}
			};

			if (document.body.classList.contains("studiOffline")) setup.base = scServices.scLoad.resolveDestUri("/lib-md/w_jwplayer/jwplayer");

			if (player.dataset.file) {
				setup.file = player.dataset.file;
			} else if (player.dataset.url) {
				setup.playlist = player.dataset.url;
			} else {
				// Configuration dans une balise fille script (pour les playlists offline)
				var script = player.getElementsByTagName("script").item(0);
				if (script) {
					var scriptSetup = JSON.parse(script.textContent);
					var playlist = scriptSetup.playlist;
					// Conversion du contenu des sous-titres en URL -->
					playlist.forEach(function (media) {
						media.tracks.forEach(function (track) {
							if (track.content) {
								track.file = URL.createObjectURL(new Blob([track.content], {type: track.type}));
							}
						});
					});
					setup.playlist = scriptSetup.playlist;
				}
			}
			jwplayer(player).setup(setup);
			
			jwplayer().on('fullscreen', function(e) {
				if (e.fullscreen == true) {
  					 document.getElementById("header").style.display = "none";
  				} else {
  					document.getElementById("header").style.display = "flex";
  				}
			});
		} catch (e) {
			console.error(e);
		}
	});
});
