var Doorbell=function(){var options={},idOrAppKeyChanged=false,host=null,recaptchaWidgetID=null,embedHost='https://embed.doorbell.io',submitting=false,uploading=false,uploadedAttachments=[],uploadedPastedAttachments=[],pastedAttachments=[],isPostmessageIframeLoaded=false,prepareFeedbackCallback=null,formQuestions=[],properties={},screenshot='',screenshotData={html:null},container=null,backgroundContainer=null,feedbackButton=null,defaultOptions={},npsRatingAllowed=false,alwaysOnScreenshot=true,emailAddressRequired=true,feedbackRequired=true,screenshotAssetErrors=false,ssLogLines=[],screenshotInlinedAssets=false,screenshotNestedInlinedAssets=false,generatingScreenshot=false,generatingScreenshotTime=0,generatingScreenshotCancelFunc=null,submitAfterScreenshot=false,languageStrings={"fr-fr":{}},setFormQuestionValues={},ariaHiddenElements=[],ariaTabIndexElements=[],autohideFormTimeout=null,defaultStrings={'title':'Signaler un bug','intro-text':'<div id="intro-text"><p><b><i> Une question ? Gagnez du temps, pensez \u00e0 consulter notre FAQ ! Sur <a href=\"https:\/\/faq.studi.fr\" target=\"_blank\">https:\/\/faq.studi.fr<\/a> !<\/p><\/b><\/i><\/b>\r\n \t<p><i>Pour un probl\u00e8me <u>technique<\/u> avec l\u0027application mobile ou la plateforme de formation web, vous \u00eates au bon endroit !<\/i><\/p>\r\n\t<b><p>Les probl\u00e8mes de <u>contenus<\/u> (erreur dans un cours, contenu manquants ...) et <u>p\u00e9dagogiques<\/u> (souci de planning, conseil ...) ne sont <font color=\"blue\">pas trait\u00e9s ici<\/font>, et nous vous rappelons que seuls les navigateurs web <font color=\"blue\">Chrome<\/font> et <font color=\"blue\">Firefox<\/font> sont actuellement support\u00e9s : nous ne pourrons pas vous aider si vous en utilisez un autre !<\/p>\r\n\t<p>Afin de faciliter la prise en charge de votre ticket, nous vous remercions de renseigner syst\u00e9matiquement votre <font color=\"blue\">formation<\/font>, et d\u0027indiquer <font color=\"blue\">pr\u00e9cis\u00e9ment l\u0027endroit<\/font> o\u00f9 cela se produit (mur, m\u00e9diath\u00e8que, lives \u2026) en pr\u00e9cisant la mati\u00e8re, module, th\u00e8me, le\u00e7on dans le cas de la m\u00e9diath\u00e8que. Nous vous conseillons de nous fournir d\u0027embl\u00e9e une <font color=\"blue\">copie d\u0027\u00e9cran<\/font> pour aider \u00e0 notre diagnostic.<\/p><\/b></div>','feedback-textarea-placeholder':'D\u00e9crivez ici le bug rencontr\u00e9','feedback-label':'','attach-a-screenshot':'Transmettre la capture \u00e9cran de l\u0027erreur','email-input-placeholder':'Votre identifiant de connexion (adresse email)','email-label':'','submit-button-text':'Envoyer le message','submitting-button-text':'Envoi en cours...','uploading-button-text':'T\u00e9l\u00e9chargement en cours...','feedback-button-text':'Signaler un bug','add-attachments-label':'','add-attachments-label-button':'Transmettre un fichier','nps-rating-label':'Globalement, \u00eates-vous satisfait du support technique STUDI ?','nps-rating-bad-label':'Pas du tout','nps-rating-good-label':'Tout \u00e0 fait','message-success':'Message envoy\u00e9 ! Nous vous remercions de votre aide','message-error-missing-email':null,'message-error-invalid-email':null,'message-error-missing-message':null,'message-error-message-too-short':null},option=function(o){if(typeof options[o]!=='undefined'){return options[o];}else if(typeof defaultOptions[o]!=='undefined'){return defaultOptions[o];}else{return null;}},canUploadAttachments=function(){if(!supportAjaxUploadWithProgress()){return false;}
return true;},installed=function(){return!!1;},getLanguage=function(){var l=option('language');if(l){return l;}
var html=document.getElementsByTagName('html');if(html.length>0){l=html[0].getAttribute('lang');if(l){return l;}}
var metaTags=document.getElementsByTagName('meta');if(metaTags.length>0){var contentLanguageMetaValues=[];for(var i=0;i<metaTags.length;i++){var httpEquiv=metaTags[i].getAttribute('http-equiv');if(!httpEquiv){continue;}
var value=metaTags[i].getAttribute('content');if(!value){continue;}
if(httpEquiv.toLowerCase()!=='content-language'){continue;}
contentLanguageMetaValues.push(value);}
if(contentLanguageMetaValues.length===1){return contentLanguageMetaValues[0];}}
return null;},getString=function(s){var strings=option('strings');if(strings!==null&&typeof strings==='object'&&typeof strings[s]!=='undefined'){return strings[s];}
var language=getLanguage();if(language!==null){if(typeof languageStrings[language]==='object'){if(typeof languageStrings[language][s]!=='undefined'){if(languageStrings[language][s]){return languageStrings[language][s];}}}}
if(typeof defaultStrings[s]!=='undefined'){return defaultStrings[s];}
return null;},getAppId=function(){return'2823';},getAppKey=function(){return options.appKey;},disableButton=function(text){var button=el('doorbell-submit-button');if(!button.disabled){button.className+=' disabled';button.disabled=true;var currentText=button.innerHTML;button.setAttribute('data-original-text',currentText);}
if(typeof text!=='undefined'&&text.length>0){button.innerHTML=text;}},enableButton=function(){var button=el('doorbell-submit-button');button.className=button.className.replace('disabled','');button.disabled=false;button.innerHTML=button.getAttribute('data-original-text');},supportAjaxUploadWithProgress=function(){function supportFileAPI(){var fi=document.createElement('INPUT');fi.type='file';return'files'in fi;}
function supportAjaxUploadProgressEvents(){var xhr=new XMLHttpRequest();return!!(xhr&&('upload'in xhr)&&('onprogress'in xhr.upload));}
function supportFormData(){return!!window.FormData;}
try{return supportFileAPI()&&supportAjaxUploadProgressEvents()&&supportFormData();}catch(e){return false;}},canGenerateScreenshot=function(){return(typeof html2canvas==='function'||typeof DoorbellScreenshot==='function');},canSendScreenshot=function(){return(isPostmessageIframeLoaded||supportAjaxUploadWithProgress())&&canGenerateScreenshot()&&true;},isNPSEnabled=function(){if(!npsRatingAllowed){return false;}
if(typeof options.nps!=='undefined'){return options.nps;}
return npsRatingAllowed;},showForm=function(){var onShowCallback=option('onShow');if(typeof onShowCallback==='function'){if(onShowCallback()===false){return;}}
try{var screenResolution=screen.width+'x'+screen.height;addProperty('Screen resolution',screenResolution);}catch(e){}
try{var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName('body')[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight;setBrowserSize(x,y);}catch(e){}
openForm();var shouldGenerateScreenshot=true;var onGenerateScreenshotCallback=option('onGenerateScreenshot');if(typeof onGenerateScreenshotCallback==='function'){if(onGenerateScreenshotCallback()===false){shouldGenerateScreenshot=false;}}
if(canSendScreenshot()===true&&shouldGenerateScreenshot===true){try{if(typeof html2canvas==='function'){var proxy=host+'/html2canvasproxy.php';generatingScreenshot=true;generatingScreenshotTime=0;var screenshotStart=new Date().getTime();html2canvas([document.body],{proxy:proxy,async:true,logging:!!'',onrendered:function(canvas){generatingScreenshotTime=(new Date().getTime())-screenshotStart;screenshot=canvas.toDataURL();var onScreenshotGeneratedCallback=option('onScreenshotGenerated');if(typeof onScreenshotGeneratedCallback==='function'){onScreenshotGeneratedCallback(screenshot);}
generatingScreenshot=false;if(submitAfterScreenshot){submit();}}});}
var alwaysInline=option('alwaysInline');if(typeof alwaysInline!=='boolean'){alwaysInline=false;}
var inlineStyles=option('inlineStyles');if(typeof inlineStyles!=='boolean'){inlineStyles=false;}
screenshotData.pagesize=htmlEditor.page_size();screenshotData.scrollposition=htmlEditor.window_scroll_position();screenshotData.devicePixelRatio=window.devicePixelRatio;screenshotData.html=null;initScreenshot(null,inlineStyles,alwaysInline);}catch(e){var attachScreenshotCheckboxWrapper=el('doorbell-attach-screenshot-wrapper');if(attachScreenshotCheckboxWrapper){attachScreenshotCheckboxWrapper.style.display='none';}}}},getScroll=function(){if(window.pageYOffset!=undefined){return[pageXOffset,pageYOffset];}else{var sx,sy,d=document,r=d.documentElement,b=d.body;sx=r.scrollLeft||b.scrollLeft||0;sy=r.scrollTop||b.scrollTop||0;return[sx,sy];}},getYScroll=function(){return getScroll()[1];},isInline=function(){return option('container')!==null;},isModal=function(){return!isInline();},openForm=function(){if(canSendScreenshot()===true&&typeof html2canvas==='function'){window.scroll(0,0);}
var emailField=el('doorbell-email');var emailLabel=el('doorbell-email-label');if(option('hideEmail')){emailField.style.display='none';if(emailLabel){emailLabel.style.display='none';}}else{emailField.style.display='block';if(emailLabel){emailLabel.style.display='block';}}
if(option('email')!==null){emailField.value=option('email');}
container.style.display='block';container.setAttribute('aria-hidden','false');try{ariaAdjustingForBodyChildren();}catch(e){}
if(isModal()){backgroundContainer.style.display='block';backgroundContainer.setAttribute('aria-hidden','false');container.style.top=getYScroll()+100+'px';if(shouldAutoFocusFields()){el('doorbell-feedback').focus();}}
formOpened();var onShownCallback=option('onShown');if(typeof onShownCallback==='function'){onShownCallback();}},ariaAdjustingForBodyChildrenReset=function(){if(isInline()){return;}
var i,element,previous;for(i=0;i<ariaHiddenElements.length;i++){element=ariaHiddenElements[i];previous=element.getAttribute('data-doorbell-previous-aria-hidden');if(previous){element.setAttribute('aria-hidden',previous);element.removeAttribute('data-doorbell-previous-aria-hidden');}else{element.removeAttribute('aria-hidden');}}
for(i=0;i<ariaTabIndexElements.length;i++){element=ariaTabIndexElements[i];previous=element.getAttribute('data-doorbell-previous-tabindex');if(previous){element.setAttribute('tabindex',previous);element.removeAttribute('data-doorbell-previous-tabindex');}else{element.removeAttribute('tabindex');}}
ariaHiddenElements=[];ariaTabIndexElements=[];},ariaAdjustingForBodyChildren=function(){if(isInline()){return;}
var i,previous;var excludeChildrenOfElements=[container,backgroundContainer];if('querySelectorAll'in document){var focusable=document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');for(i=0;i<focusable.length;i++){var element=focusable[i];if(element.tagName.toLowerCase()==='link'){continue;}
if(isDescendant(excludeChildrenOfElements,element)){continue;}
previous=element.getAttribute('tabindex');if(previous){element.setAttribute('data-doorbell-previous-tabindex',previous);}
element.setAttribute('tabindex','-1');ariaTabIndexElements.push(element);}
return;}
if(!document.body){return;}
var excludeElementIDs=['doorbell','doorbell-background'];var children=document.body.childNodes;for(i=0;i<children.length;i++){var child=children[i];if(!child){continue;}
if(child.id&&excludeElementIDs.indexOf(child.id)>=0){continue;}
if(!('getAttribute'in child)){continue;}
previous=child.getAttribute('aria-hidden');if(previous){child.setAttribute('data-doorbell-previous-aria-hidden',previous);}
child.setAttribute('aria-hidden','true');ariaHiddenElements.push(child);}},isDescendant=function(parents,child){var node=child.parentNode;while(node!=null){for(var i=0;i<parents.length;i++){if(node==parents[i]){return true;}}
node=node.parentNode;}
return false;},el=function(id){if(container&&'querySelector'in container){return container.querySelector('#'+id);}
return document.getElementById(id);},hideForm=function(){if(autohideFormTimeout){clearTimeout(autohideFormTimeout);autohideFormTimeout=null;}
if(container.style.display==='none'){return;}
var onHideCallback=option('onHide');if(typeof onHideCallback==='function'){if(onHideCallback()===false){return;}}
cancelCurrentScreenshot('hiding form');var successContainer=getAlertBox('success');successContainer.style.display='none';hideErrorMessage();try{ariaAdjustingForBodyChildrenReset();}catch(e){}
if(isModal()){backgroundContainer.style.display='none';backgroundContainer.setAttribute('aria-hidden','true');}
container.style.display='none';container.setAttribute('aria-hidden','true');screenshot='';var onHiddenCallback=option('onHidden');if(typeof onHiddenCallback==='function'){onHiddenCallback();}},getSuccessMessage=function(defaultMessage){var successMessage=option('successMessage');if(successMessage){return successMessage;}
successMessage=getString('message-success');if(successMessage){return successMessage;}
return defaultMessage;},getErrorCode=function(error){if(typeof error==='string'){return null;}
if(typeof error==='object'){return error.type;}
return null;},getErrorField=function(error){if(typeof error==='string'){return null;}
if(typeof error==='object'&&error.field){return error.field;}
return null;},getErrorMessage=function(error){if(typeof error==='string'){return error;}
if(typeof error==='object'){var errorType=error.type;var errorMessage=getString('message-error-'+errorType);if(errorMessage){return errorMessage;}}
return error.message;},showErrorMessage=function(message){var errorContainer=getAlertBox('error');errorContainer.style.display='block';errorContainer.innerHTML=message;},hideErrorMessage=function(){var errorContainer=getAlertBox('error');errorContainer.style.display='none';},showSuccessMessage=function(message){var successElement=getAlertBox('success');successElement.innerHTML=getSuccessMessage(message);successElement.style.display='block';var autohideForm=true;if(autohideForm){autohideFormTimeout=setTimeout(function(){hideForm();},3000);}},getEmail=function(){return el('doorbell-email').value;},setBrowserSize=function(w,h){var browserSize=w+'x'+h;addProperty('Browser size',browserSize);screenshotData.viewport={width:w,height:h};},clearAriaAttributes=function(input,textarea,select){var i;for(i=0;i<input.length;i++){input[i].removeAttribute('aria-describedby');}
for(i=0;i<textarea.length;i++){textarea[i].removeAttribute('aria-describedby');}
for(i=0;i<select.length;i++){select[i].removeAttribute('aria-describedby');}},getValuesOfExtraFormFields=function(input,textarea,select){var extraFields={};var formFields,formFieldCounter,field;var ignoreFields=['doorbell-feedback','doorbell-email','g-recaptcha-response'];var ignoreFieldsByName=['doorbell-nps-rating'];formFields=input;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(field.id&&field.id.length>=18&&field.id.substr(0,18)==='doorbell-question-'){continue;}
if(ignoreFields.indexOf(field.id)>=0){continue;}
if(ignoreFieldsByName.indexOf(field.name)>=0){continue;}
if(field.value.length>0&&field.name.length>0){if(field.type=='radio'||field.type=='checkbox'){if(field.checked){extraFields[field.name]=field.value;}}else if(field.type=='file'){}else{extraFields[field.name]=field.value;}}}
formFields=textarea;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(ignoreFields.indexOf(field.id)<0&&field.value.length>0&&field.name.length>0){extraFields[field.name]=field.value;}}
var selectValue;formFields=select;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];selectValue=field.options[field.selectedIndex].value;if(ignoreFields.indexOf(field.id)<0&&selectValue.length>0&&field.name.length>0){extraFields[field.name]=selectValue;}}
return extraFields;},isEmpty=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return true;},formHasFiles=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){return true;}}}
return false;},clearFileInput=function(oldInput){try{var newInput=document.createElement("input");newInput.type="file";newInput.id=oldInput.id;newInput.className=oldInput.className;newInput.name=oldInput.name;newInput.multiple=oldInput.multiple;newInput.onchange=oldInput.onchange;oldInput.parentNode.replaceChild(newInput,oldInput);}catch(e){log(e);}},clearFileInputsInForm=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){clearFileInput(input);}}}
return false;},resetAttachmentLabelButtonText=function(){if(!getString('add-attachments-label-button')){return;}
var label=el('doorbell-add-attachments-label-button');if(!label){return;}
label.innerHTML=getAttachmentLabelButtonText(getString('add-attachments-label-button'));},getNPSRating=function(){var radio=container.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){return radio[i].value;}}
return 0;},getFormQuestionValues=function(){var values=[];for(var i=0;i<formQuestions.length;i++){var question=formQuestions[i];var value=getFormQuestionValue(question);if(!value){continue;}
values.push('form_questions['+question.id+']='+encodeURIComponent(value));}
return values.join('&');},getFormQuestionValue=function(question){if(typeof setFormQuestionValues[question.id.toString()]!=='undefined'){return setFormQuestionValues[question.id.toString()];}
if(question.type==='radio'||question.type==='priority'){if(question.options.values.length===0){return null;}
for(var i=0;i<question.options.values.length;i++){var element=el('doorbell-question-'+question.id+'-value-'+i);if(!element){continue;}
if(!element.checked){continue;}
return element.value;}
return null;}
if(question.type==='checkbox'){if(question.options.values.length===0){return null;}
var values=[];for(var i=0;i<question.options.values.length;i++){var element=el('doorbell-question-'+question.id+'-value-'+i);if(!element){continue;}
if(!element.checked){continue;}
values.push(element.value);}
if(values.length>0){return JSON.stringify(values);}
return null;}
if(question.type==='star-rating'&&question.rater){return question.rater.getRating();}
if(question.type==='text'){var element=el('doorbell-question-'+question.id+'-input');if(!element){return null;}
return element.value;}
if(question.type==='dropdown'){var element=el('doorbell-question-'+question.id+'-dropdown');if(!element){return null;}
return element.value;}
return null;},submit=function(customMessage,customEmail,successCallback,errorCallback){debugLog('Calling submit');if(nativeOnSubmit()===false){return;}
var onSubmitCallback=option('onSubmit');if(typeof onSubmitCallback==='function'){if(onSubmitCallback()===false){return;}}
if(submitting||uploading){return false;}
hideErrorMessage();var uploadErrorCallback=function(text){uploading=false;showErrorMessage(text);enableButton();};var uploadForm=el('doorbell-form');if(uploadedAttachments.length===0&&uploadForm&&formHasFiles(uploadForm)){uploading=true;disableButton(getString('uploading-button-text'));if(uploadForm&&formHasFiles(uploadForm)){uploadFile(uploadForm,function(attachments){uploading=false;uploadedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}
return false;}
var i;if(uploadedPastedAttachments.length===0&&pastedAttachments.length>0){uploading=true;disableButton(getString('uploading-button-text'));if(pastedAttachments.length>0){for(i=0;i<pastedAttachments.length;i++){uploadPastedFile(pastedAttachments[i],function(attachments){uploading=false;uploadedPastedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}}
return false;}
var wantToSendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked){wantToSendScreenshot=true;}
disableButton(getString('submitting-button-text'));if(wantToSendScreenshot&&generatingScreenshot){debugLog('Waiting for screenshot to complete');submitAfterScreenshot=true;return;}
submitAfterScreenshot=false;submitting=true;var fullStoryURL=getFullStorySessionURL();if(fullStoryURL!==null){addProperty('FullStory session',fullStoryURL);}
var logRocketURL=getLogRocketSessionURL();if(logRocketURL!==null){addProperty('LogRocket session',logRocketURL);}
var sessionStackURL=getSessionStackSessionURL();if(sessionStackURL!==null){addProperty('SessionStack session',sessionStackURL);}
var smartlookURL=getSmartLookSessionURL();if(smartlookURL!==null){addProperty('SmartLook session',smartlookURL);}
var feedback=el('doorbell-feedback').value;if(typeof prepareFeedbackCallback==='function'){feedback=prepareFeedbackCallback(feedback);}
if(typeof option('onPrepareFeedback')==='function'){feedback=option('onPrepareFeedback')(feedback);}
var email=getEmail();if(typeof customMessage!=='undefined'){feedback=customMessage;}
if(typeof customEmail!=='undefined'){email=customEmail;}
try{var form=el('doorbell-form');var extraFields;if(form){var inputFields=form.getElementsByTagName('input');var textareaFields=form.getElementsByTagName('textarea');var selectFields=form.getElementsByTagName('select');clearAriaAttributes(inputFields,textareaFields,selectFields);extraFields=getValuesOfExtraFormFields(inputFields,textareaFields,selectFields);if(!isEmpty(extraFields)){addProperty('Fields',extraFields);}}}catch(e){log('Failed to get extra properties from fields');}
var serializedProperties;try{serializedProperties=JSON.stringify(properties);}catch(e){log('Failed to serialize the properties');serializedProperties=properties;}
var data='message='+encodeURIComponent(feedback)+'&email='+encodeURIComponent(email)+'&properties='+encodeURIComponent(serializedProperties);var name=option('name');if(name!==null){data+='&name='+encodeURIComponent(name);}
var formQuestionValues=getFormQuestionValues();if(formQuestionValues){data+='&'+formQuestionValues;}
var tags=option('tags');if(tags!==null){if(Object.prototype.toString.call(tags)==='[object Array]'){tags=tags.join(',');}
if(typeof tags==='string'){data+='&tags='+encodeURIComponent(tags);}}
if(uploadedAttachments.length>0){for(i=0;i<uploadedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedAttachments[i]);}}
if(uploadedPastedAttachments.length>0){for(i=0;i<uploadedPastedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedPastedAttachments[i]);}}
if(wantToSendScreenshot&&ssLogLines.length>0){data+='&screenshot_debug_log='+encodeURIComponent(JSON.stringify(ssLogLines));}
data+='&error_detail=1';try{var npsRating=getNPSRating();if(isNPSEnabled()&&npsRating>0){data+='&nps='+npsRating;}}catch(e){}
if(option('sentiment')){data+='&sentiment='+option('sentiment');}
if(generatingScreenshotTime){data+='&screenshot_generation_time='+generatingScreenshotTime;}
var l=getLanguage();if(l){data+='&language='+encodeURIComponent(l);}
if(recaptchaWidgetID!==null){var recaptchaResponse=grecaptcha.getResponse(recaptchaWidgetID);data+='&g-recaptcha-response='+encodeURIComponent(recaptchaResponse);}
if(option('demo')){data+='&demo=1';}
debugLog('Submitting');ajax({url:host+'/api/applications/'+getAppId()+'/submit',data:data,success:function(data){el('doorbell-feedback').value='';updateCharacterCount(el('doorbell-feedback'));clearFileInputsInForm(form);uploadedAttachments=[];pastedAttachments=[];uploadedPastedAttachments=[];ssLogLines=[];if(typeof clearSSLog==='function'){clearSSLog();}
refreshAttachmentsLabel();clearNPSRatingFields();clearFormQuestionFields();clearRecaptcha();var onSuccessCallback=option('onSuccess');if(typeof onSuccessCallback==='function'){onSuccessCallback();}
if(typeof successCallback==='function'){successCallback(data);}
showSuccessMessage(data);},error:function(error){var errorMessage=getErrorMessage(error);showErrorMessage(errorMessage);var errorCode=getErrorCode(error);var errorField=getErrorField(error);if(errorField){var affectedField=getFieldByName(errorField);if(affectedField){affectedField.setAttribute('aria-describedby','doorbell-error');}}
if(errorCode==='invalid-email'||errorCode==='missing-email'){var emailField=el('doorbell-email');if(emailField){emailField.style.display='block';}}
var onErrorCallback=option('onError');if(typeof onErrorCallback==='function'){onErrorCallback(errorCode,errorMessage);}
if(typeof errorCallback==='function'){errorCallback(errorMessage);}},complete:function(){submitting=false;enableButton();}});},getFieldByName=function(name){return el('doorbell-'+name);},clearNPSRatingFields=function(){var radio=container.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){radio[i].checked=false;}}},clearFormQuestionFields=function(){for(var i=0;i<formQuestions.length;i++){var question=formQuestions[i];if(question.type==='radio'||question.type==='priority'||question.type==='checkbox'){for(var j=0;j<question.options.values.length;j++){var element=el('doorbell-question-'+question.id+'-value-'+j);if(!element){continue;}
element.checked=false;}}else if(question.type==='star-rating'&&question.rater){question.rater.clear();}else if(question.type==='dropdown'){var element=el('doorbell-question-'+question.id+'-dropdown');element.value='';}else if(question.type==='text'){var element=el('doorbell-question-'+question.id+'-input');element.value='';}}},isElementVisible=function(el){if(isInline()){return fallbackIsElementVisible(el);}
if(!el.getClientRects){return fallbackIsElementVisible(el);}
try{return!!(el.offsetWidth||el.offsetHeight||el.getClientRects().length);}catch(e){return fallbackIsElementVisible(el);}},fallbackIsElementVisible=function(el){var style=window.getComputedStyle(el);return!(style.display==='none')},isSessionRecordingEnabled=function(){return false;},getLogRocketSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['LogRocket']==='undefined'){return null;}
var logRocket=window['LogRocket'];if(typeof logRocket['sessionURL']==='undefined'){return null;}
var logRocketURL=logRocket.sessionURL;if(!logRocketURL){return null;}
return logRocketURL;},getSessionStackSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['SessionStack']==='undefined'){return null;}
var sessionStack=window['SessionStack'];if(typeof sessionStack['getSessionId']!=='function'){return null;}
var sessionStackSessionURL=null;var calledBack=false;var timedOut=false;var timeoutHandler;sessionStack.getSessionId(function(sessionId){if(sessionId!==null){sessionStackSessionURL='https://app.sessionstack.com/player/#/sessions/'+sessionId;}
calledBack=true;});timeoutHandler=setTimeout(function(){timedOut=true;},100);while(!calledBack&&!timedOut){}
if(!timedOut){clearTimeout(timeoutHandler);}
return sessionStackSessionURL;},getSmartLookSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['smartlook']==='undefined'){return null;}
var smartlook=window['smartlook'];var smartlookSessionURL=null;var calledBack=false;var timedOut=false;var timeoutHandler;smartlook(function(){smartlookSessionURL=smartlook.playUrl;calledBack=true;});timeoutHandler=setTimeout(function(){timedOut=true;},100);while(!calledBack&&!timedOut){}
if(!timedOut){clearTimeout(timeoutHandler);}
return smartlookSessionURL;},getFullStorySessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['_fs_namespace']==='undefined'){return null;}
var fsNamespace=window['_fs_namespace'];if(typeof window[fsNamespace]==='undefined'){return null;}
var fsObject=window[fsNamespace];if(typeof fsObject['getCurrentSessionURL']!=='function'){return null;}
var fsURL=fsObject.getCurrentSessionURL();if(!fsURL){return null;}
return fsURL;},formOpened=function(){var poweredByLink=el('doorbell-powered-by');var visible='0';if(poweredByLink&&isElementVisible(poweredByLink)){visible='1';}
var demo='';if(option('demo')){demo='&demo=1';}
ajax({url:host+'/api/applications/'+getAppId()+'/open',data:'powered-by-link-visible='+visible+demo,success:function(data){},error:function(error){}});},nativeOnInitialize=function(){},nativeOnSubmit=function(){},ping=function(){if(installed()){return;}
if(option('demo')){return;}
ajax({url:host+'/api/applications/'+getAppId()+'/ping',success:function(data){},error:function(error){}});},debugLog=function(message){var logForKeys=['HdawR4AGD22T2WYxNFagyCslaMeeAmLIk3Po0IurhF8ESIQ1Y4sKMH3gCCkSzlZS'];if(logForKeys.indexOf(getAppKey())<0){return;}
log(message);},log=function(message){if(typeof console!=='undefined'&&typeof console.log!=='undefined'){console.log(message);}},addProperty=function(name,value){properties[name]=value;},getAuthParams=function(){var params='key='+getAppKey()+'&library=javascript';var timestamp=option('timestamp');if(timestamp){params+='&timestamp='+timestamp;}
var token=option('token');if(token){params+='&token='+token;}
var signature=option('signature');if(signature){params+='&signature='+signature;}
return params;},ajax=function(params){if(typeof params.data==='undefined'){params.data='';}
if(params.data.length>0){params.data+='&';}
params.data+=getAuthParams();try{if(window&&window.location&&window.location.href){params.data+='&url='+encodeURIComponent(window.location.href)+'&url_source=window_location_href';}else if(document&&document.documentURI){params.data+='&url='+encodeURIComponent(document.documentURI)+'&url_source=document_documenturi';}else if(document&&document.URL){params.data+='&url='+encodeURIComponent(document.URL)+'&url_source=document_url';}else{params.data+='&no_url=1&url_source=all_blank';}}catch(e){params.data+='&no_url=1&url_source=error_'+encodeURIComponent(e);}
var sendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked&&(screenshot.length>0||screenshotData.html!==null)){sendScreenshot=true;}
var screenshotBlob=null;if(sendScreenshot&&(supportAjaxUploadWithProgress()||isPostmessageIframeLoaded)){if(screenshotData.html!==null){params.data+='&screenshot_data[screen_resolution][width]='+screen.width;params.data+='&screenshot_data[screen_resolution][height]='+screen.height;params.data+='&screenshot_data[viewport][width]='+screenshotData.viewport.width;params.data+='&screenshot_data[viewport][height]='+screenshotData.viewport.height;params.data+='&screenshot_data[pagesize][width]='+screenshotData.pagesize.width;params.data+='&screenshot_data[pagesize][height]='+screenshotData.pagesize.height;params.data+='&screenshot_data[scrollposition][top]='+screenshotData.scrollposition.top;params.data+='&screenshot_data[scrollposition][left]='+screenshotData.scrollposition.left;if(screenshotData.devicePixelRatio){params.data+='&screenshot_data[device_pixel_ratio]='+screenshotData.devicePixelRatio;}
params.data+='&screenshot_data[asset_errors]='+screenshotAssetErrors;params.data+='&screenshot_data[inlined_assets]='+screenshotInlinedAssets;params.data+='&screenshot_data[nested_inlined_assets]='+screenshotNestedInlinedAssets;if(!screenshotBlob){params.data+='&screenshot_data[html]='+encodeURIComponent(screenshotData.html);}}else{params.data+='&screenshot='+screenshot;}}
if(supportAjaxUploadWithProgress()){makeCorsCall(params,screenshotBlob);}else if(isPostmessageIframeLoaded){params.referrer=window.location.href;makePostmessageCall(params);}else{makeJsonpCall(params);}},parseQuery=function(queryString){var query={};var pairs=(queryString[0]==='?'?queryString.substr(1):queryString).split('&');for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');query[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]||'');}
return query;},ajaxCallback=function(data,code,params){if(code>=200&&code<300){if(typeof params.success!=='undefined'){params.success(data);}}else{if(typeof params.error!=='undefined'){params.error(data);}}
if(typeof params.complete!=='undefined'){params.complete(data);}
if(typeof params.callback!=='undefined'){var callback=params.callback;var scriptTag=document.getElementById('doorbell-'+callback);if(scriptTag){removeElementById('doorbell-'+callback);try{delete window[callback];}catch(e){window[callback]=undefined;}}}},makeCorsCall=function(params,screenshotBlob){var xhr=new XMLHttpRequest();xhr.open('POST',params.url,true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){ajaxCallback(e,500,params);return;}
if(readyState==4){if(status>=200&&status<300&&text){ajaxCallback(text,status,params);}else{var data;try{data=JSON.parse(text);}catch(e){data=text;}
ajaxCallback(data,status,params);}}};var sendData=params.data;var usingBlob=false;if(screenshotBlob){try{var formData=new FormData();formData.append('doorbell_screenshot_file',screenshotBlob,'screenshot.html');var q=parseQuery(params.data);for(var k in q){if(!q.hasOwnProperty(k)){continue;}
formData.append(k,q[k]);}
sendData=formData;usingBlob=true;}catch(e){}}
if(!usingBlob){if('setRequestHeader'in xhr){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded;charset=UTF-8');}else{params.data+='&request_headers_supported=0';}}
xhr.send(sendData);},makePostmessageCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};if(typeof doorbellpm!=='undefined'){doorbellpm({target:window.frames["doorbellIframe"],type:"doorbellSend",data:params});}},makeJsonpCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;if(typeof params.data==='undefined'){params.data='';}
if(params.data!=''){params.data+='&';}
params.data+='callback='+params.callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.id='doorbell-'+callback;script.src=params.url+'?'+params.data;script.crossorigin='anonymous';script.onerror=function(){removeElementById('doorbell-'+callback);log('Error loading JSONP script: '+script.src);};head.appendChild(script);},clearRecaptcha=function(){if(recaptchaWidgetID!==null){grecaptcha.reset(recaptchaWidgetID);}},refreshAttachmentsLabel=function(){var fileInput=el('doorbell-add-attachments');var label=el('doorbell-add-attachments-label-button');if(label){var fileCount=0;try{if(fileInput.files&&fileInput.files.length>0){fileCount+=fileInput.files.length;}
fileCount+=pastedAttachments.length;}catch(ex){log(ex);}
if(fileCount>0){label.innerHTML=getAttachmentLabelButtonText(getString('add-attachments-label-button')+' ('+fileCount+')');}else{resetAttachmentLabelButtonText();}}},shouldAutoFocusFields=function(){if(!navigator){return true;}
if(!navigator.userAgent){return true;}
if(navigator.userAgent.match('MSIE 10')){return false;}
if(navigator.userAgent.indexOf("Trident")!==-1&&navigator.userAgent.indexOf("rv:11")!==-1){return false;}
return true;},uploadFile=function(form,successCallback,errorCallback){var xhr=new XMLHttpRequest();var urlParam='&no_url=1';try{urlParam='&url='+encodeURIComponent(window.location.href);}catch(e){}
xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams()+urlParam,true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if(status==413){text='Attachment too big';}else if(status==0&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData(form);xhr.send(formData);},uploadPastedFile=function(result,successCallback,errorCallback){var xhr=new XMLHttpRequest();xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams(),true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if((status==0||status==413)&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData();var blob=result.file;var name=result.name?result.name:'image.'+blob.type.split('/')[1];formData.append('file',blob,name);xhr.send(formData);},getAlertBox=function(type){var alert=el('doorbell-'+type);if(alert){return alert;}
alert=document.createElement('div');if(type==='success'){alert.id='doorbell-success';alert.className='alert alert-success';}else if(type==='error'){alert.id='doorbell-error';alert.className='alert alert-error alert-danger';}else{return;}
var doorbellContainer=el('doorbell-container');var fieldset=doorbellContainer.getElementsByTagName('fieldset')[0];var existingAlert=doorbellContainer.getElementsByClassName('alert')[0];fieldset.insertBefore(alert,existingAlert);return alert;},getAttachmentLabelButtonText=function(text){var paperclipDataURI='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAMQUlEQVR4Ae2dc5ArTxeGv8zu5tq2/bNt27Zt27Zt27ZtW9f2vdlk93v/mK1661SdnL6bmUkHU/XUcpKefuY0TneS/1XwURPSdNSCFcFR4F7wHvgdzAWNYBb4EbwBbgD7gBGAj1oQgOqxCEcK1NLPw8EF4HvQuIgsBO+Cg0AnIcY4qoesqEHgVoqAJupBJvyaBQ2gMfyapb9nxXn/gmNBC4pAyNeO6lFH35/BIpoEUOUzDUSjIAfqQxpDfgYbiqaRjuqRokoZBT4QInJ5KjlLMnIgS3+T52VBhn6+CMjIrMqgTnYHsIBEiCaH7nQD45wMRdOzoCUQUqqRcSR3xPLOFnLmgDfAJWAfsDnYAGwB9g9//yaYzWJExOToed4FaWq+Kl7GEVxx3DeIJuZbcDgYAFyO/qHo77THp4h8hTr4oJJlHMqRwHcw3dHjwf7c6VMTUwdqQ+roZzlYOIYiJsNSKFJuYiGVKOMglqF8fyfozBLM4So9j5AzGHyqSGl6zt3oeSpqwrc/C1CalIP5Li9gzhBQH5EGL0op9LwTQa9K6E9Yxj4OMnbk9EkM85x3pBRqum5lIeUuY0+HZmrPwqPClNILjBPPnaMbYxRLKVcZu5kyqA2PK61BzdfWJKJBRMy1ZSmEZOyiNE0sY784ZdCRosd/mcrE5RkLulAfVFYydnSQsU9CMmTTtYHMh1G5duL/LZdE4XYOMg4pQvY1RTfAV1w++noblassZGztIOMgllGkCL6Q+g8u61elPntnGVs4yDiqiDJYyObcuVMZp4PeVMaSlbGZg4wjiiyDK3kEWChTNiHLlaQQkrExyEkZYmXvBGoGSEbRhHQFk7icVNYN/E+l2CMWliHH+cd6IoP7hXbgbxZCN9VWJSWEZKwHMoaM0zySwULag38UIVuWjBCSsTb1DxklhX4KVQLw4qihNMo0pclax3shQsYaYL4h4xy5XOuZkGVkuUnO4vy/vstYDSw0ZJzpqQy+6/fm6KBoH09rMYHvMlYGcxQZWd7V4akMruT7lInhOzyz91nGimCeIeN8ceFeHdQE9QFTqfws5AKOJF9lLAdmGjKu8FwGX8/JQgJ36Gv4KqSOOr/ZhoxLPZfB0dEdTKH+g8V8Ss1UykcZS4KphozrfJch+rO786ytH+hddJCMxcEMuYkN5OgCri4FGVTBR4qRFcv4ka498E3GGDBJ2TrTdAG3lMLGZZKxg7ipGsXsfBv+f59kjKQ2dqEi40bfZYhr2lHJPmeo2fUyMoaDcYaMO0tMxpayrxAy3vSq2aWCDwUTFBlNhb+dZZTJ6uWqvCvFl4IPBv8YMu7PIyMI8W2NxnVZoMangg8A/xky7jVkyK02xb6mTR1knMjl9kVGP/CHIeNRVQbtTCz2iiBd07ogZ8jwalmgjvI5fxkyHtJk0ONsLjYwJC6FyrK+wxrN6T7K6AV+NmQ85SBjI5ATHeUxCTYFXJbVQcaQcRaVyxsZPcBvhownuFlSHmcdnu3SRbOUVELXtCZYYMg410cZ3cD3Uoa4kBccZKymrBjy98tzdMV4TSspZeF82wU+yugCfpQyxM/POchYIU8FyC0/qZivaRUw15BxCZ3njYzO4CtDxqsgZchYCkx3XEtnIcVaFrjcRxkdwbeGjJdBjSFjTB4Z2STaaSrL8g4LZlf5KKM9+NSQ8TaoNWQMA+OMCriSKyDuZQEjE32tjzLagi8MGW+AtCFjoJ1wjH1dhBfMphkybvBRRhvwgSHjA9DCkNEX/G7IuD1uGbwsYMi4WZk7Jb/Bmyq1FfjYkPEuaGXI6KHJoAq5gy84RhmjHRbMbjNkJBI1UkZL8LYh41PQmi5YGyJ/a8h4JCEZQ8AEe43GlDGEZNQkISMN3jNkfATaGjLag2+MyeOjCckYBsYaN8Y9DimetUEuiZFXDQ0zXzZkfAXaSxlCamvwkfE4L/J5McroD/5t1hqNnlWIdW7CHdSDRiV+DjoYMlqAD43HeQmkEpAxCPwdQSZ6bTp/IU1eL+N6jLqpOo4SfA2yEsH3oJMhowa85jAQqEtARm/wZ7PWaOxN4byF6XoSAqKRsarc2iIK8A3okk9GeLxqyHgv5ndgs4fZMhPtHhkZY+dMwUL45C/yZFx/A90UGXwhT4rzpIwvQdsEZHQHvxgynnbKRLMMeyIbWXQck2dL5CQwSJHBHdkT/H6EioyO/DgxyegJfjJk2Jlot8i4PspOPaB1jfFipY4rdCMaCmvRdZch42fQNQEZncH3ioyFtEYTFBQZ9ky+oOg4M09TdaVScC7E+YaMX0DPBGR0dcxEFx4ZMewpCyhP9RdFB3/9i4a3gSJzDTkQEBXwL+iXgIz2Dms0r4G65kYG/XwXy4jjLY94BzffBfsrFZmir59qfU8oY3ACMjo6ZKLfBIEdGaaM++KQwZXKoyKOjj8oRxUoF7ATyxTnTwUjE5DR2nGNpmUEkfFgXDIC2tg2TXlt3NnKBaR4vsHniP5jQx4IxLhG85HDnCddQGTEn2+jguzAd7iQspSR7RwE5giZMqxrY05+vm/I+BC0iSAynohTBj/otSSAv34sI0J7hzcpM2SlmITwGs27hoyPaY2mroDIeCbW5Keo4HdYBBXiChanVMo5yuuyv6f/CWKQUQPeMmR8pic/7cig3z8fa/JTVFIH8J/y7gO7KIXg8+9QhDwYo4w68Loh4wvQtpmRITPRsUaGbK6GgwXKG26twP+rCHlYEXJ1xG0tV8YrhoyvQWc7MkwZr8mdM0kI4cwuR8cs0N9ByP2KkJsiFMJN34uGjG9Bx0IjQ85Xklwv35hksJBxtN4R5BF6nSLk5YjS0FwZzxupmR9Ad4fIWGDIeEfOV5IUspXypo1/URscOGSH5ZsHT6HKCSKQ8Ywh4yfQNYLIeF/OV5IWsqUi5G/QzkHIuiLCOOVyQAEzdLm2YiUtexcQGcZmjWSFbKg0WZNAN4c+pCMY65CUrG1mZDxmyPgd9IwgMj4DrYslgyt5RWW3+QIwTBMifn+XnljkHRz2hYoUy8OGjD/BgAgi4ws5ECimkMFgLjdbdPHraXe3+P0qYqQmR2zX8DkhAXX4AaijMrVwWHX8G/SNIDK+5m1MPrwDWlu5DkJ399GGEJ7xP6qszuVoqXQAsI6VwdfGjpd/wZAIIuM70M0HGTJ18poQIZNpgUOkDQCzxePI1bU54HqwFugeRkLL8E7fkqIiXyWOBYMiiIwfQRdfZMgm51Jl6DrBbehKH7IimysgJdFjfwd+ANOU/5WVOB6MLCgy7FGZF0I24z5EVOieVsFFpJyQ5y7PcWUrf8spCb5xYJgdGVKGPSrz6QhoU8A4pR9503GvEc/IjxcVIaKFPmsWCAmc9s5RxzuooMiwR2XeSbmTL0aMttbliHKUsiH4h5shqmTtU5qzLIJen5GOoM/4J+ZNFnFPEPni9CgxPuyxM7gYTJcCtAghPgUbczkLiIz/wFCvZSgV/BndzbJzPshlbVypwF7gMPAKmKj0IVnwO7gHbCQiOCigzxgPBnsvQ7nAvfLsHpkFBi7ihQUshl7StjLYFuwdPueWYBnQTpfqHhn080QwutRkyP1Vn+TZvfhxMxdsauT/WxKpTGqfYciYIobIJXfUKh/9pr3szFkKi6cKr2MonWLkuJwiYxpYspRlyLnEbcqqXD2/E1xCFxyIVL8lYwZYohxkyI0PvxqbjJ8FLejCY3steXhsA+oNGbPA8uUiQzZDy4Cs8cn9P9BGiCjF1IqU/0UcpYqMOWC5cpMh78ydHSoiC84ArdQUu/sH1cvOfDXwoZYfozLMA6uVqwwZKftrUsTPf4CDQQdZ2aITr+WflcWvlcCD4nkalHnGArBKucuQM+4DuSKMhOHf4BKwGmgNXI+BYD/wSh7pMuE4E6wuZVSKlE3BHPnabCIb0iii5ilwbljZW4INwcZgR3AMuAl8TI+dLyrq6Tl+BMPLXobxsQyj6TUYtLwqxMhRkDtZx8e8F7SrHBn2EPQcOZNXUuhZUB+S5fUWaupC1PP5ef4EO8p+rpIProDFwVOySQnhXJiAMgB6BlgKmgrOF69zrAHVg2bOPCK6n9bTuXIzIVISRwj/jxT0EzgN9KxGhX3IOcNgcBx4A8wCjc3kD3An2FLObexJZ/VIKRXVD2wOzgQPgvfBz2AGRc448BV4GVwPDgbLg9bGrL2sjv8DUEM4lFfAOsEAAAAASUVORK5CYII=';return'<span><img src="'+paperclipDataURI+'" alt="Paperclip Icon" />'+text+'</span>';},removeElementById=function(id){var removeEl=document.getElementById(id);if(removeEl){try{removeEl.parentNode.removeChild(removeEl);}catch(e){}}},removeElement=function(element){if(element){try{element.parentNode.removeChild(element);}catch(e){}}},removeDoorbell=function(){removeElement(feedbackButton);removeElement(backgroundContainer);removeElement(container);},showScreenshotWarning=function(){var e=el('attach-screenshot-warning');if(e){e.style.display='inline';}},hideScreenshotWarning=function(){var e=el('attach-screenshot-warning');if(e){e.style.display='none';}},updateCharacterCount=function(textarea){var counter=el('doorbell-character-count');if(counter){counter.innerHTML=textarea.value.length;}
if(el('doorbell-max-character-count-reached-message')&&el('doorbell-character-count-container')){if(textarea.value.length>=option('max-character-count')){el('doorbell-max-character-count-reached-message').style.display='inline';el('doorbell-character-count-container').className+=' doorbell-max-character-count-reached ';}else{el('doorbell-max-character-count-reached-message').style.display='none';el('doorbell-character-count-container').className=el('doorbell-character-count-container').className.replace('doorbell-max-character-count-reached','');}}},buildFormComponentHTML=function(component){if(component==='intro-text'){return getString('intro-text');}
if(component==='feedback'){var feedbackLabel=getString('feedback-label');if(feedbackLabel){feedbackLabel='<label for="doorbell-feedback" id="doorbell-feedback-label">'+feedbackLabel+'</label>';}
var requiredAttribute='required="required"';if(!feedbackRequired){requiredAttribute='';}
var feedbackTextAreaCharacterCount='';var maxLengthAttribute='';if(option('show-character-counter')&&option('max-character-count')){var limitReachedMessage='<span id="doorbell-max-character-count-reached-message" style="display: none;">'+(option('max-character-count-reached-message')?option('max-character-count-reached-message'):'')+'</span>';feedbackTextAreaCharacterCount='<p id="doorbell-character-count-container"><span id="doorbell-character-count">0</span><span id="doorbell-character-count-separator">/</span><span id="doorbell-character-count-max">'+option('max-character-count')+'</span>'+limitReachedMessage+'</p>'
maxLengthAttribute='maxlength="'+option('max-character-count')+'"';}
var feedbackTextareaAriaLabel='';if(!feedbackLabel){feedbackTextareaAriaLabel='aria-label="'+getString('feedback-textarea-placeholder')+'"';}
var feedbackTextarea='<textarea placeholder="'+getString('feedback-textarea-placeholder')+'" '+feedbackTextareaAriaLabel+' class="form-control" name="message" id="doorbell-feedback" '+maxLengthAttribute+' '+requiredAttribute+'></textarea>';return feedbackLabel+feedbackTextarea+feedbackTextAreaCharacterCount;}
if(component==='email'){var emailLabel=getString('email-label');if(emailLabel){emailLabel='<label for="doorbell-email" id="doorbell-email-label">'+emailLabel+'</label>';}
var requiredAttribute='required="required"';if(!emailAddressRequired){requiredAttribute='';}
var emailInputAriaLabel='';if(!emailLabel){emailInputAriaLabel='aria-label="'+getString('email-input-placeholder')+'"';}
return emailLabel+'<input type="email" id="doorbell-email" '+emailInputAriaLabel+' class="form-control" placeholder="'+getString('email-input-placeholder')+'" name="email" value="" '+requiredAttribute+' />';}
if(component==='attachments'){if(!canUploadAttachments()){return'';}
var addAttachmentLabel=getString('add-attachments-label');if(addAttachmentLabel){addAttachmentLabel='<label for="doorbell-add-attachments" id="doorbell-add-attachments-label">'+addAttachmentLabel+'</label>';}else{addAttachmentLabel='';}
var addAttachmentLabelButton='';if(getString('add-attachments-label-button')){addAttachmentLabelButton='<label id="doorbell-add-attachments-label-button" for="doorbell-add-attachments">'+getAttachmentLabelButtonText(getString('add-attachments-label-button'))+'</label>';}
var attachmentInput='<input id="doorbell-add-attachments" class="'+(addAttachmentLabelButton?'has-label-button':'')+'" name="files[]" type="file" multiple="multiple" />';return addAttachmentLabel+addAttachmentLabelButton+attachmentInput;}
if(component==='screenshot'){if(!canSendScreenshot()){return'';}
var attachScreenshotWarning='<span id="attach-screenshot-warning" style="display: none;"> (some assets might be missing)</span>';var attachScreenshotWrapperVisibility='';if(alwaysOnScreenshot){alwaysOnScreenshot='checked="checked"';attachScreenshotWrapperVisibility='display: none;'}
return'<div class="checkbox" id="doorbell-attach-screenshot-wrapper" style="'+attachScreenshotWrapperVisibility+'"><label for="doorbell-attach-screenshot"><input type="checkbox" id="doorbell-attach-screenshot" value="1" '+alwaysOnScreenshot+' /> '+getString('attach-a-screenshot')+attachScreenshotWarning+'</label></div>';}
if(component==='nps'){if(!isNPSEnabled()){return'';}
var npsRating='<label>'+getString('nps-rating-label')+'</label>';npsRating+='<div class="clearfix">';for(var iNPS=0;iNPS<=10;iNPS++){npsRating+='<label id="nps-value-'+iNPS+'" for="nps-checkbox-'+iNPS+'" style="float: left; width: 9.09%; margin: 0; text-align: center;">';npsRating+='<input id="nps-checkbox-'+iNPS+'" class="doorbell-nps-rating" type="radio" name="doorbell-nps-rating" value="'+iNPS+'" /><br /><span>'+iNPS+'</span>';npsRating+='</label>';}
npsRating+='</div>';npsRating+='<p class="clearfix">';npsRating+='<span style="float: left;">'+getString('nps-rating-bad-label')+'</span>';npsRating+='<span style="float: right;">'+getString('nps-rating-good-label')+'</span>';npsRating+='</p>';return npsRating;}
if(component.length>=9&&component.substr(0,9)==='question_'){var questionID=component.replace('question_','');var question=getFormQuestion(questionID);if(!question){return'';}
var questionLabel=question.label;if(getString('form-question-'+questionID+'-label')){questionLabel=getString('form-question-'+questionID+'-label');}
var formQuestion='<div id="doorbell-question-'+questionID+'" class="doorbell-question doorbell-question-type-'+question.type+'">';if(questionLabel){formQuestion+='<label id="doorbell-question-'+questionID+'-label" for="doorbell-question-'+questionID+'">'+questionLabel+'</label>';}
if(question.type==='radio'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];var questionValueLabel=value;var questionValueLabelSlug=value.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="radio" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else if(question.type==='checkbox'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];var questionValueLabel=value;var questionValueLabelSlug=value.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="checkbox" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else if(question.type==='star-rating'){formQuestion+='<div class="doorbell-question-field clearfix"></div>';}else if(question.type==='text'){var requiredAttribute='';if(question.required){requiredAttribute='required="required"';}
var hasHelperText=question.options&&question.options.helper;formQuestion+='<div class="doorbell-question-field clearfix"><input type="text" id="doorbell-question-'+questionID+'-input" aria-label="'+question.label+'" class="form-control" placeholder="'+((question.options&&question.options.placeholder)?question.options.placeholder:'')+'" name="question_'+questionID+'" value="" '+requiredAttribute+' '+(hasHelperText?'style="margin-bottom: 0;"':'')+' />'+(hasHelperText?'<p style="padding: 0; margin: 0 0 10px 0; line-height: 1.42857143;"><small>'+question.options.helper+'</small></p>':'')+'</div>';}else if(question.type==='dropdown'){var requiredAttribute='';if(question.required){requiredAttribute='required="required"';}
var optionsString='<option value="" selected="selected"></option>';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];optionsString+='<option value="'+value+'">'+value+'</option>';}
var hasHelperText=question.options&&question.options.helper;formQuestion+='<div class="doorbell-question-field clearfix"><select id="doorbell-question-'+questionID+'-dropdown" aria-label="'+question.label+'" class="form-control" name="question_'+questionID+'" '+requiredAttribute+' '+(hasHelperText?'style="margin-bottom: 0;"':'')+'>'+optionsString+'</select>'+(hasHelperText?'<p style="padding: 0; margin: 0 0 10px 0; line-height: 1.42857143;"><small>'+question.options.helper+'</small></p>':'')+'</div>';}else if(question.type==='priority'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var questionOption=question.options.values[i];var questionValueLabel=questionOption.label;var questionValueLabelSlug=questionOption.label.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="radio" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+questionOption.value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else{return'';}
formQuestion+='</div>';return formQuestion;}
return'';},getFormQuestion=function(id){for(var i=0;i<formQuestions.length;i++){if(formQuestions[i].id==id){return formQuestions[i];}}
return null;},setRecaptchaWidgetID=function(id){recaptchaWidgetID=id;},buildFormHTML=function(){var postMessageIframe='';if(canSendScreenshot()===true){if(!supportAjaxUploadWithProgress()){postMessageIframe='<iframe name="doorbellIframe" id="doorbellIframe" src="'+host+'/api/form?t=1710932106'+'" style="display: none!important;"></iframe>';}}
var components=["intro-text","feedback","email","attachments","screenshot","nps"];var componentsHTML=[];for(var i=0;i<components.length;i++){var componentHTML=buildFormComponentHTML(components[i]);componentsHTML.push(componentHTML);}
return'<div id="doorbell-container" role="dialog" aria-labelledby="doorbell-title"><button id="doorbell-close" title="Close" class="close" aria-label="Close"><span>&times;</span></button><form id="doorbell-form" class="dark">                <fieldset>                    <legend id="doorbell-title">'+getString('title')+'</legend>                    <div id="doorbell-success" class="alert alert-success" style="display: none;"></div>                    '+componentsHTML.join("\n")+'                                        <div class="buttons"><button class="btn btn-primary" id="doorbell-submit-button">'+getString('submit-button-text')+'</button></div>                </fieldset>                                '+postMessageIframe+'            </form></div>';},preInit=function(){},cancelCurrentScreenshot=function(reason){if(typeof generatingScreenshotCancelFunc==='function'){ssLogLines=generatingScreenshotCancelFunc(reason);generatingScreenshotCancelFunc=null;}
generatingScreenshot=false;},initScreenshot=function(callback,inlineStyles,alwaysInline){if(typeof htmlEditor==='undefined'||typeof DoorbellScreenshot!=='function'){return;}
cancelCurrentScreenshot('starting new one');if(typeof inlineStyles==='undefined'){inlineStyles=false;}
if(typeof alwaysInline==='undefined'){alwaysInline=false;}
generatingScreenshot=true;hideScreenshotWarning();screenshotAssetErrors=false;screenshotInlinedAssets=false;screenshotNestedInlinedAssets=false;var doorbellScreenshotCallback=function(html,assetErrors,inlinedAssets,nestedInlinedAssets){screenshotAssetErrors=assetErrors;screenshotInlinedAssets=inlinedAssets;screenshotNestedInlinedAssets=nestedInlinedAssets;screenshotData.html=html;generatingScreenshot=false;if(submitAfterScreenshot){submit();}
if(typeof callback==='function'){callback(screenshotData);}};var removeDisplayNoneElements=true;generatingScreenshotCancelFunc=DoorbellScreenshot({inlineStyles:inlineStyles,alwaysInline:alwaysInline,removeDisplayNoneElements:removeDisplayNoneElements,onRendered:function(html,assetErrors,inlinedAssets,nestedInlinedAssets,ssLogLinesReturned){generatingScreenshotCancelFunc=null;ssLogLines=ssLogLinesReturned;if(assetErrors&&!inlineStyles){initScreenshot(callback,true,alwaysInline);}else{doorbellScreenshotCallback(html,assetErrors,inlinedAssets,nestedInlinedAssets);}}});};if('Blob'in window&&'FormData'in window&&canUploadAttachments()){function addPasteImageReaderListener(callback){var options={matchType:/image.*/};if('addEventListener'in window){document.getElementsByTagName('html')[0].addEventListener('paste',function(event){try{if(document.getElementById('doorbell').style.display==='none'){return;}
var element=this;var clipboardData=event.clipboardData;if(!clipboardData){clipboardData=event.originalEvent.clipboardData;}
if(!clipboardData.items){return;}
var hasFiles=false;Array.prototype.forEach.call(clipboardData.types,function(type,i){if(type.match(options.matchType)||clipboardData.items[i].type.match(options.matchType)){var file=clipboardData.items[i].getAsFile();if(file){callback.call(element,{file:file,name:file.name});hasFiles=true;}}});if(hasFiles){event.stopPropagation();event.preventDefault();}}catch(e){}});}}
addPasteImageReaderListener(function(result){pastedAttachments.push(result);refreshAttachmentsLabel();});}
var ssProfileStartTimes=[];var ssLogLinesInternal=[];function clearSSLog(){ssLogLinesInternal=[];}
function ssLog(s){var t='';if(ssProfileStartTimes.length>0){t=((new Date().getTime()-ssProfileStartTimes[0].getTime())/ 1000).toFixed(2);t+=' seconds'+"\t";}
ssLogLinesInternal.push(t+s);if(console&&console.log){var logForKeys=['9qySZhC0i9LGg4XNcBQnqua2JnYN2UPDp6eFw64F5YNHfr5q6gHdAr8zt5ujTxfY','HdawR4AGD22T2WYxNFagyCslaMeeAmLIk3Po0IurhF8ESIQ1Y4sKMH3gCCkSzlZS'];var screenshotDebug=window.doorbellOptions&&window.doorbellOptions.debug;if(logForKeys.indexOf(window.doorbellOptions.appKey)<0&&!screenshotDebug){return;}
console.log(t+s);}}
function DoorbellScreenshot(options){ssProfileStartTimes.push(new Date());try{ssLog('Starting screenshot process: '+JSON.stringify(options));}catch(e){ssLog('Starting screenshot process');}
var cancelled=false;var cancelFunc=function(reason){cancelled=true;ssLog('Screenshot cancelled ('+reason+')');ssProfileStartTimes.shift();return ssLogLinesInternal;};var onRenderedCalled=false;var assetsTested=false;var failedAssets=[];var failedInlinedAssets=[];var inlinedAssets=0;var nestedInlinedAssets=0;var html=null;var assets=[];var testedAssetCount=0;var inlineStyles=options['inlineStyles'];if(typeof inlineStyles==='undefined'){inlineStyles=false;}
var removeDisplayNoneElements=options['removeDisplayNoneElements'];if(typeof removeDisplayNoneElements==='undefined'){removeDisplayNoneElements=true;}
var alwaysInline=options['alwaysInline'];if(typeof alwaysInline==='undefined'){alwaysInline=false;}
if(!inlineStyles&&usesReactJSStyledComponents()){ssLog('Inlining styles because of StyledComponents');inlineStyles=true;}
if(!inlineStyles&&usesReactEmotionJS()){ssLog('Inlining styles because of EmotionJS');inlineStyles=true;}
window.setTimeout(function(){ssLog('Before getHTML call');getHTML(function(returnedHTML){html=returnedHTML;onScreenshotComplete(true);});ssLog('After getHTML call, should be immediate return to be async again');},100);function usesReactJSStyledComponents(){var styles=document.getElementsByTagName('style');for(var i=0;i<styles.length;i++){if(styles[i].getAttribute('data-styled-components')!==null){return true;}
if(styles[i].getAttribute('data-styled-version')!==null){return true;}}
return false;}
function usesReactEmotionJS(){var styles=document.getElementsByTagName('style');for(var i=0;i<styles.length;i++){if(styles[i].getAttribute('data-emotion')!==null){return true;}}
return false;}
function onScreenshotComplete(completed){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before onScreenshotComplete');return;}
if(html&&assetsTested&&failedAssets.length===0){var didAssetsFailWithAllMethods=(failedAssets.length>0||failedInlinedAssets.length>0);var wereAssetsInlined=inlinedAssets>0;var wereNestedAssetsInlined=nestedInlinedAssets>0;options['onRendered'](html,didAssetsFailWithAllMethods,wereAssetsInlined,wereNestedAssetsInlined,ssLogLinesInternal);ssLog('Called onScreenshotComplete');if(!onRenderedCalled){onRenderedCalled=true;ssProfileStartTimes.shift();}
return;}
if(html&&testedAssetCount===0){testAssets();return;}
if(html&&assetsTested&&failedAssets.length>0){inlineAssets();return;}}
function inlineNestedCSSAssets(url,body,callback){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before inlineNestedCSSAssets');return;}
ssLog('Attempting to inline nested assets for '+url);var parts=body.split(',',2);if(parts.length<2){callback(url,body,null);return;}
var header=parts[0];if(header.length<13){callback(url,body,null);return;}
if(header.substr(0,5)!=='data:'){callback(url,body,null);return;}
if(header.substr(5,8)!=='text/css'){callback(url,body,null);return;}
var data=parts[1];var wasBase64Encoded=false;if(header.substr(-7)===';base64'){if(!('atob'in window)||!('btoa'in window)){callback(url,body,null);return;}
data=window.atob(data);wasBase64Encoded=true;}
var result=htmlEditor.makeAbsoluteURLsWithBase(data,url);data=result.cssText;var urlsFound=result.urls;urlsFound=dedupURLs(urlsFound);if(urlsFound.length===0){callback(url,body,null);return;}
ssLog('Convert and inline assets found in '+url+': '+urlsFound.join(', '));convertAssetsToProxyURLsOrDataURIs(urlsFound,function(assetResults,failed){if(failed.length>0){ssLog('Failed to get '+failed.length+' assets, in a nested point: '+failed.join(', '));}
data=injectNestedInlinedAssets(data,assetResults);var newData=header+',';if(wasBase64Encoded){data=window.btoa(data);}
newData+=data;callback(url,body,newData);});}
function convertAssetsToProxyURLsOrDataURIs(assets,callback){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before convertAssetsToProxyURLsOrDataURIs');return;}
ssLog('Starting to convert '+assets.length+' to proxy URLs or data URIs');var done=0;var assetResults=[];var failed=[];for(var i=0;i<assets.length;i++){var asset=assets[i];var proxyURL=proxyTestURL(asset);ssLog('Testing asset '+asset+' with proxy');jsonpCall(proxyURL,assets[i],function(u,asset,statusCode){if(cancelled){return;}
ssLog('JSONP callback for '+asset+', status code: '+statusCode);if(statusCode>=200&&statusCode<=400){ssLog('Asset '+asset+' is fine with proxy');assetResults.push({url:asset,result:htmlEditor.proxyURL(asset)});done++;if(done===assets.length){ssLog('Completed the conversion of '+assets.length+' to data uris');callback(assetResults,failed);}}else{ssLog('Converting asset '+asset+' to data uri');toDataURL(asset,function(url,result,reason){if(cancelled){return;}
if(result){ssLog('Converted asset '+asset+' to data uri');if(result.indexOf('data:text/css')===0){inlineNestedCSSAssets(url,result,function(url,result,newResult){if(cancelled){return;}
if(newResult!==null){result=newResult;}
assetResults.push({url:url,result:result});done++;if(done===assets.length){ssLog('Completed the conversion of '+assets.length+' to data uris');callback(assetResults,failed);}});return;}
assetResults.push({url:url,result:result});}else{ssLog('Failed to convert asset '+asset+' to data uri. Reason: '+reason);failed.push(url);}
done++;if(done===assets.length){ssLog('Completed the conversion of '+assets.length+' to data uris');callback(assetResults,failed);}});}});}}
function injectNestedInlinedAssets(body,assets){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before injectNestedInlinedAssets');return;}
function replaceAll(subject,search,replace){return subject.split(search).join(replace);}
for(var i=0;i<assets.length;i++){if(!assets[i].result){continue;}
var proxiedURL=htmlEditor.proxyURL(assets[i].url);body=replaceAll(body,assets[i].url,assets[i].result);body=replaceAll(body,assets[i].url.replace('&','&amp;'),assets[i].result);body=replaceAll(body,proxiedURL,assets[i].result);body=replaceAll(body,proxiedURL.replace('&','&amp;'),assets[i].result);nestedInlinedAssets++;}
return body;}
function dedupURLs(urls){var dedup=[];for(var i=0;i<urls.length;i++){if(dedup.indexOf(urls[i])<0){dedup.push(urls[i]);}}
return dedup;}
function inlineAssets(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before inlineAssets');return;}
ssLog('calling inline assets');failedInlinedAssets=[];convertAssetsToProxyURLsOrDataURIs(failedAssets,function(assetResults,failed){if(cancelled){return;}
injectInlinedAssets(assetResults);for(var i=0;i<failed.length;i++){failedInlinedAssets.push(failed[i]);}
failedAssets=[];ssLog('inlining assets completed');onScreenshotComplete(true);});}
function injectInlinedAssets(assets){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before injectInlinedAssets');return;}
function replaceAll(subject,search,replace){return subject.split(search).join(replace);}
var entirelyUniqueURLs=[];var existAsSubstringSoDoLast=[];for(var i=0;i<assets.length;i++){var url1=assets[i];var foundURL1AsSubstringOfOtherLinks=false;for(var j=0;j<assets.length;j++){if(i==j){continue;}
var url2=assets[j]+'';if(url2&&url2.indexOf(url1)>=0){foundURL1AsSubstringOfOtherLinks=true;break;}}
if(foundURL1AsSubstringOfOtherLinks){existAsSubstringSoDoLast.push(url1);ssLog('Moving asset '+url1+' to the end of list for replacing, as it exists as a substring');}else{entirelyUniqueURLs.push(url1);}}
assets=[];for(var i=0;i<entirelyUniqueURLs.length;i++){assets.push(entirelyUniqueURLs[i]);}
for(var i=0;i<existAsSubstringSoDoLast.length;i++){assets.push(existAsSubstringSoDoLast[i]);}
for(var i=0;i<assets.length;i++){if(!assets[i].result){continue;}
var proxiedURL=htmlEditor.proxyURL(assets[i].url);html=replaceAll(html,assets[i].url,assets[i].result);html=replaceAll(html,assets[i].url.replace('&','&amp;'),assets[i].result);html=replaceAll(html,proxiedURL,assets[i].result);html=replaceAll(html,proxiedURL.replace('&','&amp;'),assets[i].result);inlinedAssets++;}}
function toDataURL(url,callback){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before toDataURL');return;}
var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){var status,response,readyState;try{readyState=xhr.readyState;response=xhr.response;status=xhr.status;}catch(e){callback(url,null,'error reading XHR');return;}
if(readyState==4){if(!response){callback(url,null,'empty response, status code: '+status);}else if(status>=200&&status<300){var reader=new FileReader();reader.onloadend=function(){callback(url,reader.result,'filereader success');};reader.readAsDataURL(response);}else{callback(url,null,'had response, but status code: '+status);}}};xhr.open('GET',url);xhr.responseType='blob';if('withCredentials'in xhr){xhr.withCredentials=true;}
xhr.send();}
function proxyTestURL(u){var ref='';try{ref=window.location.href;}catch(e){}
if(!htmlEditor.should_proxy(u)){return null;}
return'https://embed.doorbell.io/proxy?test=1&url='+encodeURIComponent(u)+'&referer='+encodeURIComponent(ref);}
function testAssets(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before testAssets');return;}
ssLog('Start testAssets');if(assets.length===0){ssLog('No assets, carry on');assetsTested=true;onScreenshotComplete(true);return;}
var maxDurationInMilliseconds=10000;setTimeout(function(){if(!assetsTested){assetsTested=true;ssLog('Reached timeout of screenshot not ready ('+maxDurationInMilliseconds+'ms), calling onScreenshotComplete anyway');onScreenshotComplete(false);}},maxDurationInMilliseconds);for(var i=0;i<assets.length;i++){ssLog('Testing asset '+assets[i]);if(alwaysInline){ssLog('Always inlining assets, so setting '+assets[i]+' as failed so we inline it');testedAssetCount++;failedAssets.push(assets[i]);if(testedAssetCount>=assets.length){assetsTested=true;onScreenshotComplete(true);}
continue;}
if(hasAnyOfPrefixes(assets[i],['file:','blob:'])){ssLog('We need to definitely inline '+assets[i]+', so go through the failed asset flow');testedAssetCount++;failedAssets.push(assets[i]);if(testedAssetCount>=assets.length){assetsTested=true;onScreenshotComplete(true);}
continue;}
var url=proxyTestURL(assets[i]);if(!url){ssLog('Asset '+assets[i]+' is not proxy-able, so calling this one done');testedAssetCount++;if(testedAssetCount>=assets.length){assetsTested=true;onScreenshotComplete(true);}
continue;}
ssLog('Actually testing '+assets[i]);jsonpCall(url,assets[i],function(u,asset,statusCode){if(cancelled){return;}
ssLog('Testing of '+asset+' finished: '+statusCode);if(statusCode>=200&&statusCode<=400){}else{failedAssets.push(asset);}
testedAssetCount++;if(testedAssetCount>=assets.length){assetsTested=true;onScreenshotComplete(true);}});}
ssLog('End of testAssets, but calls are probably still ongoing');}
function hasAnyOfPrefixes(s,prefixes){for(var i=0;i<prefixes.length;i++){if(s.substr(0,prefixes[i].length)===prefixes[i]){return true;}}
return false;}
function jsonpCall(url,asset,callback){function removeElement(id){var removeEl=document.getElementById(id);if(removeEl){try{removeEl.parentNode.removeChild(removeEl);}catch(e){}}}
if(url===null){callback(url,asset,500);return;}
var callbackFunc;do{callbackFunc='jsonp'+(new Date().getTime());}while(typeof window[callbackFunc]==='function');url+='&callback='+callbackFunc;window[callbackFunc]=function(response){removeElement('doorbell-'+callbackFunc);callback(url,asset,response.code);};var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.id='doorbell-'+callback;script.src=url;script.crossorigin='anonymous';script.onerror=function(){removeElement('doorbell-'+callbackFunc);callback(url,asset,500);};head.appendChild(script);}
function getDoorbellElementsAndOthersToRemove(documentClone){var doorbellAndExtraElements=[];var e;e=htmlEditor.get_element_by_id_in(documentClone,"doorbell-button","button");if(e){doorbellAndExtraElements.push(e);}
e=htmlEditor.get_element_by_id_in(documentClone,"doorbell-background","div");if(e){doorbellAndExtraElements.push(e);}
e=htmlEditor.get_element_by_id_in(documentClone,"doorbell","div");if(e){doorbellAndExtraElements.push(e);}
e=htmlEditor.get_element_by_id_in(documentClone,"ghostery-purple-box","div");if(e){doorbellAndExtraElements.push(e);}
return doorbellAndExtraElements;}
function isFullyBelowViewport(el){var runForKeys=['z5gssXCGkLSiObbb73EhtjPt5Nj4YdOJU0l7PMktH6SbUv1n5xU9GyJypWfCuC18','HdawR4AGD22T2WYxNFagyCslaMeeAmLIk3Po0IurhF8ESIQ1Y4sKMH3gCCkSzlZS'];if(!window.doorbellOptions){}
if(runForKeys.indexOf(window.doorbellOptions.appKey)<0){}
if('getBoundingClientRect'in el){var rect=el.getBoundingClientRect();var height=(htmlEditor.page_size().height*2);if(rect.top>height){return true;}
var width=(htmlEditor.page_size().width*2);if(rect.left>width){return true;}}
return false;}
function getHTML(getHTMLCallback){ssLog('Getting all elements');var elements=document.getElementsByTagName("*");ssLog('Got all elements');var iElem,element,style;for(iElem=0;iElem<elements.length;iElem++){element=elements[iElem];if("body"!=element.tagName.toLowerCase()){if(['doorbell-feedback','doorbell-email'].indexOf(element.id)>=0){}else{htmlEditor.save_field_value(element);htmlEditor.save_scroll_position(element)}}}
ssLog('Looped over all elements');ssLog('Getting all canvas elements');var canvasElements=document.getElementsByTagName("canvas");for(iElem=0;iElem<canvasElements.length;iElem++){htmlEditor.canvas_to_png(canvasElements[iElem]);}
ssLog('Looped over all canvas elements');var canComputeStyles=('getComputedStyle'in window);var removingDisplayNoneElements=false;var elementsWithAnimationsToBePausedHaveBeenMarked=false;if(canComputeStyles){var ignoreElements=['style','link','head','html'];var markedToRemoveDueToDisplayNone=0;var cssAnimationPrefix=htmlEditor.get_css_animation_prefix();for(iElem=0;iElem<elements.length;iElem++){element=elements[iElem];if(ignoreElements.indexOf(element.tagName.toLowerCase())>=0){continue;}
style=window.getComputedStyle(element);if(removeDisplayNoneElements&&style&&style.getPropertyValue('display')==='none'){if('childNodes'in element){for(var c=0;c<element.childNodes.length;c++){if(!('setAttribute'in element.childNodes[c])){continue;}
if(ignoreElements.indexOf(element.childNodes[c].tagName.toLowerCase())>=0){continue;}
element.childNodes[c].setAttribute('data-doorbell-remove-display-none','true');markedToRemoveDueToDisplayNone++;}}}
if(cssAnimationPrefix!==null&&'setAttribute'in element){if(parseFloat(style.getPropertyValue(cssAnimationPrefix+"animation-duration"))>0){element.setAttribute('data-doorbell-pause-animation','true');}
elementsWithAnimationsToBePausedHaveBeenMarked=true;}}
if(markedToRemoveDueToDisplayNone>0){removingDisplayNoneElements=true;}
ssLog('Marked '+markedToRemoveDueToDisplayNone+' elements to be removed');}
ssLog('Before pause CSS animations');var elementsWithPausedCSSAnimations=htmlEditor.pause_css_animations(elementsWithAnimationsToBePausedHaveBeenMarked);ssLog('Done pausing CSS animations');var serializeCSSStyleDeclaration=function(o){var css='';for(var i=0;i<o.length;i++){var propertyName=o.item(i);css+=propertyName+':'+o.getPropertyValue(propertyName)+';';}
return css;};var savedInlineStyles=false;if(inlineStyles){if(canComputeStyles){ssLog('Inlining styles');try{for(iElem=0;iElem<elements.length;iElem++){element=elements[iElem];var tagName=element.tagName.toLowerCase();var parentTagName=element.parentElement?element.parentElement.tagName.toLowerCase():'';if(tagName==='style'||tagName==='noscript'||tagName==='script'||tagName==='head'||parentTagName==='head'){ssLog('Skipping inline styles for element '+tagName+'(#'+element.id+'.'+element.getAttribute('class')+')')}else{var isFullyBelow=isFullyBelowViewport(element);ssLog('Processing element '+tagName+'(#'+element.id+'.'+element.getAttribute('class')+'), isFullyBelow: '+JSON.stringify(isFullyBelow))
if(isFullyBelow){var rect=element.getBoundingClientRect();element.setAttribute('data-doorbell-inlined-style','visibility: hidden!important;');try{element.setAttribute('data-doorbell-bounding-client-rect',JSON.stringify(rect).replace(/"/g,''));}catch(e){ssLog('Error with bounding rect');ssLog(e);}}else{style=window.getComputedStyle(element);if(style.display==='none'){element.setAttribute('data-doorbell-inlined-style','display: none!important;');}else{element.setAttribute('data-doorbell-inlined-style',serializeCSSStyleDeclaration(style));}}}}
savedInlineStyles=true;ssLog('Done inlining styles');}catch(e){ssLog('Error saving inline styles: '+e);}}else{ssLog('Want to inline styles, but cannot get computed styles');}}
ssLog('Before cloning');var documentClone=document.documentElement.cloneNode(!0);ssLog('Done cloning');setTimeout(function(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML cloning');return;}
setTimeout(function(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML attribute adjusting');return;}
if(savedInlineStyles||removingDisplayNoneElements){for(iElem=0;iElem<elements.length;iElem++){element=elements[iElem];element.removeAttribute('data-doorbell-inlined-style');element.removeAttribute('data-doorbell-remove-display-none');element.removeAttribute('data-doorbell-pause-animation');}}
ssLog('Before removing script and noscript elements from clone');var scriptAndNoScriptElements=htmlEditor.get_elements_by_tag_names(['script','noscript'],documentClone);ssLog('Found '+scriptAndNoScriptElements.length+' script and noscript elements to remove');htmlEditor.remove_elements(scriptAndNoScriptElements);ssLog('After removing script and noscript elements from clone');ssLog('Before removing link elements from clone');var linkElements=htmlEditor.get_elements_by_tag_names(['link'],documentClone);for(iElem=linkElements.length-1;iElem>=0;iElem--){var relAttr=linkElements[iElem].getAttribute('rel');if(relAttr==='icon'||relAttr==='apple-touch-icon'||relAttr==='preload'||relAttr==='modulepreload'||relAttr==='prefetch'||relAttr==='manifest'||relAttr==='preconnect'||relAttr==='prerender'||relAttr==='subresource'){ssLog('Removed rel='+linkElements[iElem].getAttribute('rel')+' link element');htmlEditor.remove_elements([linkElements[iElem]]);}}
ssLog('After removing link elements from clone');if(savedInlineStyles){}
if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML removing doorbell HTML components');return;}
ssLog('Before removing doorbell HTML components');var doorbellAndExtraElements=getDoorbellElementsAndOthersToRemove(documentClone);htmlEditor.remove_elements(doorbellAndExtraElements);ssLog('After removing doorbell HTML components (removed '+doorbellAndExtraElements.length+')');ssLog('Double checking doorbell HTML components removed (found '+getDoorbellElementsAndOthersToRemove(documentClone).length+')');ssLog('Before autofocus');var tagnameElements=htmlEditor.get_elements_by_tag_names(["input","textarea","button"],documentClone);for(var c=0,n=tagnameElements.length;c<n;c++){tagnameElements[c].removeAttribute("autofocus");}
ssLog('After autofocus');ssLog('Adjust links');tagnameElements=htmlEditor.get_elements_by_tag_names(["link"],documentClone);for(c=0;c<tagnameElements.length;c++){tagnameElements[c].removeAttribute("integrity");tagnameElements[c].removeAttribute("crossorigin");}
ssLog('After link adjusting');if('querySelectorAll'in documentClone){ssLog('Removing all display none elements');var displayNoneElements=documentClone.querySelectorAll('[data-doorbell-remove-display-none="true"]');ssLog('Found '+displayNoneElements.length+' elements to remove');if(displayNoneElements.length>0){htmlEditor.remove_elements(displayNoneElements);}
ssLog('Removed '+displayNoneElements.length+' display none marked elements based on querySelectorAll');ssLog('After removing all display none elements');}
if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML getting all clone elements');return;}
ssLog('Before get all clone elements');elements=documentClone.getElementsByTagName("*");ssLog('After getting all clone elements');if(inlineStyles){documentClone.removeAttribute('style');}
setTimeout(function(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML cloning iframes');return;}
ssLog('Before getting clone iframes');var iframeElements=documentClone.getElementsByTagName("iframe");for(iElem=0;iElem<iframeElements.length;iElem++){htmlEditor.update_iframe_src(iframeElements[iElem]);}
ssLog('After adjusting clone iframes');ssLog('Before adjusting URLs and removing display none elements');var displayNoneMarkedElementsRemoved=0;for(var i=elements.length-1;i>=0;i--){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML while adjusting URLs and removing display none elements');return;}
element=elements[i];if(inlineStyles){element.removeAttribute('style');}
if('getAttribute'in element&&element.getAttribute('srcset')){element.setAttribute('data-srcset-backup',element.getAttribute('srcset'));element.removeAttribute('srcset');}
if(removingDisplayNoneElements){if('getAttribute'in element){try{if(element.getAttribute('data-doorbell-remove-display-none')==='true'){htmlEditor.remove_elements([element]);displayNoneMarkedElementsRemoved++;continue;}}catch(e){ssLog('Error removing "display: none" marked element: '+e);}}}
var adjustedURLs=htmlEditor.make_urls_absolute(element);for(var j=0;j<adjustedURLs.length;j++){if(adjustedURLs[j].indexOf('data:')===0){ssLog('Got a datauri in the adjusted URLs, ignoring it');continue;}
if(assets.indexOf(adjustedURLs[j])>=0){continue;}
assets.push(adjustedURLs[j]);}}
ssLog('Removed '+displayNoneMarkedElementsRemoved+' display none marked elements when looping through all elements');ssLog('After adjusting URLs and removing display none elements');setTimeout(function(){if(cancelled){ssLog('Stopping process, screenshot has been cancelled before getHTML adjusting canvases');return;}
ssLog('Adjusting normal document canvases');for(iElem=0;iElem<canvasElements.length;iElem++){canvasElements[iElem].removeAttribute("data-doorbell-canvas-png");}
ssLog('After adjusting normal document canvases');var html=documentor.document_html(documentClone);ssLog('Before resuming CSS animations');htmlEditor.resume_css_animations(elementsWithPausedCSSAnimations);ssLog('After resuming CSS animations');getHTMLCallback(html);},100);},100);},100);},100);}
var documentor=function(){return{doctype:function(){var e="";return document.doctype&&(e="<!DOCTYPE ",e+=document.doctype.name,e+=document.doctype.publicId?' PUBLIC "'+document.doctype.publicId+'"':"",e+=!document.doctype.publicId&&document.doctype.systemId?" SYSTEM":"",e+=document.doctype.systemId?' "'+document.doctype.systemId+'"':"",e+=">"),e},element_html:function(e){try{return e.outerHTML||function(){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}()}catch(t){return""}},document_html:function(e){var e=e||document.documentElement;return this.doctype()+this.element_html(e)}}}();return cancelFunc;}
var htmlEditor=function(){return{default_value:function(e,t){return"undefined"==typeof e?t:e},update_iframe_src:function(iframeElement){var updatedSrc=iframeElement.getAttribute('data-doorbell-src');if(updatedSrc){iframeElement.setAttribute('src',updatedSrc);}},save_field_value:function(e){var t=String(e.tagName).toLowerCase();if("input"==t){var n=String(e.getAttribute("type")).toLowerCase();if("checkbox"==n||"radio"==n){e.checked?e.setAttribute("checked","checked"):e.removeAttribute("checked");}else if("password"!=n){var elementName=String(e.getAttribute("name")).toLowerCase(),r=/(card|cc|acct).?(number|#|no|num)|nummer|credito|numero|nmero|numro||.*||||/g,i=/verification|card identification|security code|card code|cvn|cvv|cvc|csc|cvd|cid|ccv/g;if(r.test(elementName)||i.test(elementName)){}else{e.setAttribute("value",e.value);}}}else if("textarea"==t){var a=document.createTextNode(e.value);e.innerHTML="",e.appendChild(a),a=null}else{"option"==t&&(e.selected?e.setAttribute("selected","selected"):e.removeAttribute("selected"))}},viewport_size:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},page_size:function(){var e={width:0,height:0};document.documentElement&&(e.width=Math.max(document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth),e.height=Math.max(document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight));var t={width:0,height:0};return document.body&&(t.width=Math.max(document.body.scrollWidth,document.body.offsetWidth),t.height=Math.max(document.body.scrollHeight,document.body.offsetHeight)),{width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)}},fit_element_to_viewport:function(e){if(e){var t=this.viewport_size(),n=this.window_scroll_position();e.style.position="absolute",e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.top=n.top+"px",e.style.left=n.left+"px",e.style.right=null,e.style.bottom=null}},on_window_resize:function(e){if(e){var t;window.onresize=function(n){clearTimeout(t),t=setTimeout(function(){e(n)},100)}}else window.onresize=null},preventDefault:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1},disable_scroll:function(){var e=this.window_scroll_position();window.onscroll=function(){window.scrollTo(e.left,e.top)}},enable_scroll:function(){window.onscroll=null},save_scroll_position:function(e){var t={top:0,left:0},n=String(e.tagName).toLowerCase();"body"==n?t=this.window_scroll_position():(t.top=e.scrollTop,t.left=e.scrollLeft),t.top||t.left?e.setAttribute("data-doorbell-scroll",t.left+"x"+t.top):e.removeAttribute("data-doorbell-scroll")},window_scroll_position:function(){function e(e){for(var t=0,n=0;n<e.length;n++)"undefined"!=typeof e[n]&&(e[n]&&e[n]<t||0==t)&&(t=e[n]);return t}
return{top:e([window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop]),left:e([window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft])}},should_proxy:function(u){if(this.hasAnyOfPrefixes(u,['chrome-extension://','data:','about:','blob:','moz-extension://','https://tag.userreport.com/server','http://tag.userreport.com/server'])){return false;}
if(this.hasAnyOfPrefixes(u,['http://','https://'])){return true;}
return false;},hasAnyOfPrefixes:function(s,prefixes){for(var i=0;i<prefixes.length;i++){if(s.substr(0,prefixes[i].length)===prefixes[i]){return true;}}
return false;},makeAbsoluteURLsWithBase:function(cssText,base){function absolute(base,relative){var stack=base.split("/"),parts=relative.split("/");stack.pop();for(var i=0;i<parts.length;i++){if(parts[i]==".")
continue;if(parts[i]=="..")
stack.pop();else
stack.push(parts[i]);}
return stack.join("/");}
var urls=[];var newCSSText=cssText.replace(/url\('?"?(.+?)'?"?\)/gi,function(e,t){if(t.indexOf('data:')===0){ssLog('We should leave data URIs alone!');return e;}
if(htmlEditor.hasAnyOfPrefixes(t,['/','//'])||t.indexOf('://')>=0){var el=document.createElement("a");el.setAttribute("href",t);urls.push(el.href);return e.replace(t,el.href);}
var absoluteURL=absolute(base,t);urls.push(absoluteURL);return e.replace(t,absoluteURL);});return{cssText:newCSSText,urls:urls};},makeAbsoluteURLs:function(cssText){return cssText.replace(/url\('?"?(.+?)'?"?\)/gi,function(e,t){var el=document.createElement("a");el.setAttribute("href",t);var u=htmlEditor.makeAbsolute(el.href);htmlEditor.urls.push(u);return e.replace(t,u);}).replace(/@import\s?'?"?(.+?)'?"?\s?;/gi,function(e,t){var el=document.createElement("a");el.setAttribute("href",t);if(t.indexOf('https://embed.doorbell.io')>=0){ssLog('Already proxied, so not replacing '+t);return e.replace(t,t);}
var u=htmlEditor.makeAbsolute(el.href);htmlEditor.urls.push(u);return e.replace(t,u);});},makeAbsolute:function(text){htmlEditor.urls.push(text);return htmlEditor.proxyURL(text);},proxyURL:function(u){var ref='';try{ref=window.location.href;}catch(e){}
if(!htmlEditor.should_proxy(u)){return u;}
return'https://embed.doorbell.io/proxy?url='+encodeURIComponent(u)+'&referer='+encodeURIComponent(ref);},make_urls_absolute:function(element){htmlEditor.urls=[];var tagName=String(element.tagName).toLowerCase();if(tagName==='link'&&element.getAttribute('rel')&&element.getAttribute('rel')==='canonical'){ssLog('Skipping favicon because of rel attribute value (canonical)');return htmlEditor.urls;}
var attributes=['href','src','background','poster'];for(var i=0;i<attributes.length;i++){var attr=attributes[i];if(tagName==='a'&&attr==='href'){continue;}
if(tagName==='base'&&attr==='href'){continue;}
if(!element.getAttribute(attr)){continue;}
var linkValue=element.getAttribute(attr);if(linkValue.indexOf('data:')===0){ssLog('We should leave data URIs alone!');continue;}
if(tagName==='iframe'&&attr==='src'&&linkValue.indexOf('ressources.studi.fr')>=0&&linkValue.indexOf('viewers/pdf.js')>=0){continue;}
var tempElement=document.createElement("a");tempElement.setAttribute("href",linkValue);if(tagName==='iframe'&&attr==='src'){if(linkValue!==tempElement.href){}else{continue;}}
if(tagName==='audio'&&attr==='src'){element.setAttribute(attr,tempElement.href);continue;}else if(tagName==='link'&&element.getAttribute('rel')&&element.getAttribute('rel').match(/\bicon\b/)){element.setAttribute(attr,tempElement.href);continue;}else if(tagName==='link'&&element.getAttribute('href')&&element.getAttribute('href').match(/\bfavicon\.\b/)){element.setAttribute(attr,tempElement.href);continue;}else if(tagName==='link'&&element.getAttribute('type')&&element.getAttribute('type')==='image/x-icon'){element.setAttribute(attr,tempElement.href);continue;}else if(tagName==='link'&&element.getAttribute('rel')&&element.getAttribute('rel').toLowerCase()!=='stylesheet'){element.setAttribute(attr,tempElement.href);continue;}
try{element.setAttribute(attr,htmlEditor.makeAbsolute(tempElement.href));}catch(u){}}
if(element.style&&element.style.cssText){element.style.cssText=htmlEditor.makeAbsoluteURLs(element.style.cssText);}
if(element.getAttribute("data-doorbell-inlined-style")){var currentValue=element.getAttribute("data-doorbell-inlined-style");var newAttributeValue=htmlEditor.makeAbsoluteURLs(currentValue);element.setAttribute("data-doorbell-inlined-style",newAttributeValue);}
if(tagName==="style"){if(element.textContent){var previous=element.textContent;element.textContent=htmlEditor.makeAbsoluteURLs(element.textContent);ssLog('Adjusted from: '+previous);ssLog('Adjusted to: '+element.textContent);}else if(element.innerText){var previous=element.innerText;element.innerText=htmlEditor.makeAbsoluteURLs(element.innerText);ssLog('Adjusted from: '+previous);ssLog('Adjusted to: '+element.innerText);}}
return htmlEditor.urls;},swap_elements:function(e,t){e.parentNode.replaceChild(t,e)},remove_elements:function(e){if(e){e=this.force_array(e);for(var t=e.length-1;t>=0;t--){if(e[t].parentNode){e[t].parentNode.removeChild(e[t]);}}}},get_element_by_id_in:function(doc,lookingForID,tagName){tagName=tagName||"*";var elements=doc.getElementsByTagName(tagName);for(var i=0;i<elements.length;i++){if(elements[i].getAttribute("id")==lookingForID){return elements[i];}}
return null;},get_elements_by_tag_names:function(tagNames,doc){var elements=[];for(var o=0;o<tagNames.length;o++){var tagNameElements=doc.getElementsByTagName(tagNames[o]);for(var i=0;i<tagNameElements.length;i++){elements.push(tagNameElements[i]);}}
return elements;},force_array:function(e){return e[0]?e:[e];},canvas_to_png:function(e){if(e.toDataURL)try{e.setAttribute("data-doorbell-canvas-png",e.toDataURL());}catch(t){}},is_property_animatable:function(e){var animatableProperties=["background","background-color","background-position","background-size","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-width","border-color","border-left","border-left-color","border-left-width","border-right","border-right-color","border-right-width","border-spacing","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-width","bottom","box-shadow","clip","color","column-count","column-gap","column-rule","column-rule-color","column-rule-width","column-width","columns","filter","flex","flex-basis","flex-grow","flex-shrink","font","font-size","font-size-adjust","font-stretch","font-weight","height","left","letter-spacing","line-height","margin","margin-bottom","margin-left","margin-right","margin-top","max-height","max-width","min-height","min-width","opacity","order","outline","outline-color","outline-offset","outline-width","padding","padding-bottom","padding-left","padding-right","padding-top","perspective","perspective-origin","right","text-decoration-color","text-indent","text-shadow","top","transform","transform-origin","vertical-align","visibility","width","word-spacing","z-index"];for(var n=0;n<animatableProperties.length;n++){if(e===animatableProperties[n]){return true;}}
return false;},get_css_animation_prefix:function(){var prefixes=["","-webkit-","-moz-","-o-"];var prefixCount=prefixes.length;var validPrefix=null;var tmpAnchor=document.createElement("a").style;for(var i=0;i<prefixCount;i++){tmpAnchor.setProperty(prefixes[i]+"animation-duration","42s");var propValue=tmpAnchor.getPropertyValue(prefixes[i]+"animation-duration");if(propValue&&propValue==="42s"){validPrefix=prefixes[i];break;}}
return validPrefix;},pause_css_animations:function(elementsMarked){if(!("getComputedStyle"in window)){return[];}
var cssAnimationPrefix=htmlEditor.get_css_animation_prefix();if(cssAnimationPrefix===null){return[];}
var elements;if(elementsMarked&&'querySelectorAll'in document){ssLog('Getting marked elements for CSS pausing');elements=document.querySelectorAll('[data-doorbell-pause-animation="true"]');ssLog('Got '+elements.length+' marked elements for CSS pausing');}else{ssLog('Getting all elements to check for CSS pausing');elements=document.getElementsByTagName("*");ssLog('Got '+elements.length+' elements to check for CSS pausing');if(elements.length>5000){return[];}}
var prefixes=["","-webkit-","-moz-","-o-"];var prefixCount=prefixes.length;var alteredElements=[];for(var c=0;c<elements.length;c++){var element=elements[c];var computedStyle=getComputedStyle(element);if(parseFloat(computedStyle.getPropertyValue(cssAnimationPrefix+"animation-duration"))>0){element.setAttribute("data-doorbell-original-style",element.style.cssText);for(var m=0;m<computedStyle.length;m++){var item=computedStyle.item(m);if(this.is_property_animatable(item)){var h=computedStyle.getPropertyValue(item);element.style.setProperty(item,h,"important")}}
element.style.setProperty(cssAnimationPrefix+"animation-play-state","paused","important");for(var i=0;i<prefixCount;i++){element.style.setProperty(prefixes[i]+'animation','none','important');}
alteredElements.push(element);}}
ssLog('Paused animation for '+alteredElements.length+' elements');return alteredElements;},resume_css_animations:function(alteredElements){for(var t=0,n=alteredElements.length;t<n;t++){var o=alteredElements[t];o.setAttribute("style",o.getAttribute("data-doorbell-original-style"));o.removeAttribute("data-doorbell-original-style");}}}}();return{init:function(opts){preInit();options=opts;var onLoadCallback=option('onLoad');if(typeof onLoadCallback==='function'){onLoadCallback();}
host='https://doorbell.io';var hideButton=option('hideButton');if((hideButton===null||hideButton===false)&&isModal()){feedbackButton=document.createElement('button');feedbackButton.id='doorbell-button';feedbackButton.onclick=showForm;feedbackButton.className='bottom_right';feedbackButton.style.visibility='hidden';feedbackButton.innerHTML=getString('feedback-button-text');document.body.appendChild(feedbackButton);}
var head=document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0];var includeStylesheets=true;if(includeStylesheets){var stylesheet=document.createElement('link');stylesheet.href='https://embed.doorbell.io/css/doorbell.min.css?v=1710843745';stylesheet.rel='stylesheet';stylesheet.type='text/css';stylesheet.id='doorbell-css-document';stylesheet.crossorigin='anonymous';var extraStylesheet=null;var extraStylesheetFilename='';if(extraStylesheetFilename.length>0){extraStylesheet=document.createElement('link');extraStylesheet.href='https://embed.doorbell.io/css/'+extraStylesheetFilename+'?v=1710843745';extraStylesheet.rel='stylesheet';extraStylesheet.type='text/css';extraStylesheet.id='doorbell-css-extra';extraStylesheet.crossorigin='anonymous';}
var customCSS="#doorbell-button {\r\n    background: #ffa51d;\r\n    color: #000000;\r\n   font-weight: 700;\r\n  display:none;\r\n}";var customCSSElement=null;if(customCSS){customCSSElement=document.createElement('style');customCSSElement.setAttribute('type','text/css');customCSSElement.textContent=customCSS;}
if(!document.getElementById(stylesheet.id)){if(customCSSElement){head.insertBefore(customCSSElement,head.firstChild);}
head.insertBefore(stylesheet,head.firstChild);if(extraStylesheet){head.insertBefore(extraStylesheet,head.firstChild);}}}
var initProperties=option('properties');if(typeof initProperties==='object'&&initProperties!==null){properties=initProperties;}
if(typeof doorbellpm!=='undefined'){doorbellpm.bind("doorbellIframeloaded",function(){isPostmessageIframeLoaded=true;return true;});doorbellpm.bind("doorbellSuccess",function(data){window[data.callback](data);return true;});doorbellpm.bind("doorbellError",function(data){window[data.callback](data);return true;});}
var formHtml=buildFormHTML();if(isModal()){backgroundContainer=document.createElement('div');backgroundContainer.id='doorbell-background';backgroundContainer.className='dark';backgroundContainer.style.display='none';document.body.appendChild(backgroundContainer);backgroundContainer.onclick=function(e){var evt=(e)?e:window.event;if(evt!=null&&evt.target!=null&&evt.target.id=='doorbell-background'){hideForm();}};}
container=document.createElement('div');container.id='doorbell';container.setAttribute('role','dialog');container.setAttribute('aria-labelledby','doorbell-title');container.setAttribute('tabindex','-1');container.setAttribute('aria-hidden','true');container.innerHTML=formHtml;container.style.display='none';if(isModal()){document.body.appendChild(container);el('doorbell-close').onclick=function(){hideForm();};}else{var inlineContainer=option('container');if(typeof inlineContainer==='function'){inlineContainer=inlineContainer();}
container.className='doorbell-inline';inlineContainer.appendChild(container);}
if(option('show-character-counter')&&option('max-character-count')&&el('doorbell-feedback')){var characterCountCallback=function(e){updateCharacterCount(this);if(el('doorbell-feedback').value.length>=option('max-character-count')){e.preventDefault();return false;}};el('doorbell-feedback').onchange=characterCountCallback;el('doorbell-feedback').onkeydown=characterCountCallback;el('doorbell-feedback').onkeyup=characterCountCallback;el('doorbell-feedback').onkeypress=characterCountCallback;el('doorbell-feedback').oninput=characterCountCallback;el('doorbell-feedback').onpaste=characterCountCallback;}
for(var i=0;i<formQuestions.length;i++){if(formQuestions[i].type!=='star-rating'){continue;}
var questionContainer=el('doorbell-question-'+formQuestions[i].id);var starContainer=questionContainer.getElementsByClassName('doorbell-question-field');if(!starContainer){continue;}
if(starContainer.length!=1){continue;}
starContainer=starContainer[0];var questionRater=rater({element:starContainer,max:5,showToolTip:false,starSize:30,rateCallback:function(rating,done){questionRater.setRating(rating);done();}});formQuestions[i].rater=questionRater;}
var doorbellForm=el('doorbell-form');doorbellForm.onsubmit=function(){submit();return false;};var doorbellInputs=doorbellForm.getElementsByTagName('input');for(var i=0;i<doorbellInputs.length;i++){var input=doorbellInputs[i];if(input.type==='file'){input.onchange=function(e){uploadedAttachments=[];refreshAttachmentsLabel();}}}
el('doorbell-feedback').onkeydown=function(e){var evt=(e)?e:window.event;if((evt.ctrlKey||evt.metaKey)&&evt.keyCode==13){submit();evt.preventDefault();evt.stopPropagation();return false;}};document.onkeydown=function(evt){evt=evt||window.event;if(evt.keyCode==27){hideForm();}};if(el('g-recaptcha-'+getAppId())){var recaptchaCallback='onRecaptchaV2Load'+getAppId();window[recaptchaCallback]=function(){var recaptchaElement=el('g-recaptcha-'+getAppId());if(!recaptchaElement){return;}
var recaptchaSize='normal';var width=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName('body')[0].clientWidth;if(width<430){recaptchaSize='compact';}
var recaptchaWidgetID=grecaptcha.render(recaptchaElement,{sitekey:'6LcG63cUAAAAAO9VuaUdrEU2BnXBvUHr9w58ob8H',size:recaptchaSize});setRecaptchaWidgetID(recaptchaWidgetID);el('g-recaptcha-response').setAttribute('aria-hidden','true')
delete window[recaptchaCallback];};var recaptchaScript=document.createElement('script');recaptchaScript.src='https://www.google.com/recaptcha/api.js?onload='+recaptchaCallback+'&render=explicit';if(getLanguage()){recaptchaScript.src+='&hl='+getLanguage();}
document.body.appendChild(recaptchaScript);}
nativeOnInitialize();var onInitialized=option('onInitialized');if(typeof onInitialized==='function'){onInitialized();}
ping();if(isInline()){showForm();}},getProperty:function(name){if(typeof properties[name]!=='undefined'){return properties[name];}else{return null;}},setProperty:function(name,value){addProperty(name,value);},setBrowserSize:function(width,height){setBrowserSize(width,height);},getOption:function(o){return option(o);},setOption:function(option,value){options[option]=value;if(option==='id'||option==='appKey'){idOrAppKeyChanged=true;}},setName:function(newName){options.name=newName;},show:function(){showForm();},hide:function(){hideForm();},send:function(message,email,successCallback,errorCallback){submit(message,email,successCallback,errorCallback);},remove:function(){removeDoorbell();},refresh:function(){removeDoorbell();if(!idOrAppKeyChanged){this.init(options);}else{var currentScript=document.getElementById('doorbellScript');if(currentScript){currentScript.parentNode.removeChild(currentScript);}
var g=document.createElement('script');g.id='doorbellScript';g.type='text/javascript';g.async=true;g.crossorigin='anonymous';g.src=embedHost+'/button/'+getAppId()+'?t='+(new Date().getTime());(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(g);}},showError:function(message){showErrorMessage(message);},setQuestionValue:function(questionID,value){setFormQuestionValues[questionID.toString()]=value;},initScreenshot:function(callback){screenshotData.pagesize=htmlEditor.page_size();screenshotData.scrollposition=htmlEditor.window_scroll_position();screenshotData.devicePixelRatio=window.devicePixelRatio;screenshotData.html=null;initScreenshot(callback);}};};if(typeof window.html2canvas==='undefined'){}
(function(){var doorbellOptionsVarName='doorbellOptions';var doorbellObjectName='doorbell';var options;if(typeof window[doorbellOptionsVarName]==='undefined'){return;}else if(typeof window[doorbellOptionsVarName].appKey==='undefined'){return;}else{options=window[doorbellOptionsVarName];}
window[doorbellObjectName]=new Doorbell();window[doorbellObjectName].init(options);})();